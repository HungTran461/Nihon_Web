<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mystic Galaxy - Modular Version</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style2.css">
</head>
<body>

    <audio id="bgm" loop> <source src="bgm.mp3" type="audio/mpeg"> </audio>
    <audio id="sfx-spin"> <source src="spin.mp3" type="audio/mpeg"> </audio>
    <audio id="sfx-win"> <source src="win.mp3" type="audio/mpeg"> </audio>
    
    <div class="flash" id="flash"></div>

    <header>
        <div class="header-left">
            <a href="index.html" class="menu-btn">‚¨Ö <span>Trang ch·ªß</span></a>
            <button class="menu-btn" onclick="openCollection()">üìñ <span>B·ªô S∆∞u T·∫≠p</span></button>
            <button class="menu-btn" onclick="openHistory()">üìú <span>L·ªãch S·ª≠</span></button>
            <button class="menu-btn" onclick="openModal('giftcodeModal')">üéÅ <span>Giftcode</span></button>
        </div>
        <div class="currency-wrapper">
            <span class="coin-text">üíé <span id="coin-display">...</span></span>
            <button class="add-coin-btn" onclick="openRecharge()">+</button>
        </div>
    </header>

    <div class="summon-stage" id="stageArea">
        <div class="magic-circle-wrapper">
            <div class="mc-ring mc-text-layer mc-text-outer" id="runeOuter"></div>
            <div class="mc-ring mc-text-layer mc-text-inner" id="runeInner"></div>
            <div class="mc-ring mc-outer"></div>
            <div class="mc-ring mc-middle"></div>
            <div class="mc-ring mc-inner"></div>
            <div class="mc-floor-glow"></div>
        </div>
        <div class="crystal-orb" id="orb"></div>
        <div class="controls-area">
            <div class="btn-group">
                <button class="summon-btn" id="btnx1" onclick="pull(1)">
                    QUAY x1 <small>üíé 1.000</small>
                </button>
                <button class="summon-btn btn-x10" id="btnx10" onclick="pull(10)">
                    QUAY x10 <small>üíé 10.000</small>
                </button>
                <button class="summon-btn btn-x50" id="btnx50" onclick="pull(50)">QUAY x50 <small>üíé 50.000</small></button>
            </div>
            <div style="font-size:0.8rem; color:#ccc; margin-top:5px">B·∫£o ƒëaÃâm ra SSR: <span id="pity-display">0</span>/150</div>
            <button class="reset-btn" onclick="resetData()">‚Üª Reset Data</button>
        </div>
    </div>
    <div class="modal-overlay" id="gridModal">
        <div class="modal-box" style="text-align:center">
            <div class="modal-body">
                <h2 style="color:var(--neon-gold)">K·∫æT QU·∫¢</h2>
                <div class="grid-view" id="resultGrid"></div>
            </div>
            <button class="action-btn" onclick="closeModal('gridModal')">ƒê√ìNG</button>
        </div>
    </div>

    <div class="modal-overlay" id="detailModal">
        <div class="modal-box detail-box">
            <div class="modal-body" style="padding:0; overflow:hidden">
                <div class="detail-container">
                    <div class="detail-visual"><img src="" id="dImg"></div>
                    <div class="detail-info" style="padding:20px">
                        <div class="d-rarity" id="dRarity"></div>
                        <div class="d-name" id="dName"></div>
                        <div class="d-desc" id="dDesc"></div>
                        <div class="stat-row">
                            <div class="stat-label"><span>ATK </span><span id="valAtk"></span></div>
                            <div class="progress-bg"><div class="progress-fill fill-atk" id="barAtk"></div></div>
                        </div>
                        <div class="stat-row">
                            <div class="stat-label"><span>DEF </span><span id="valDef"></span></div>
                            <div class="progress-bg"><div class="progress-fill fill-def" id="barDef"></div></div>
                        </div>
                        <button class="action-btn" onclick="closeModal('detailModal')">QUAY L·∫†I</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="collectionModal">
        <div class="modal-box">
            <div class="modal-header">
                <span>TH∆Ø VI·ªÜN LINH H·ªíN</span>
                <button class="modal-close" onclick="closeModal('collectionModal')">√ó</button>
            </div>
            <div class="modal-body">
            <div class="stats-container" id="colStats"></div>
            
            <div class="tab-bar">
                <button class="tab-btn active" onclick="filterCollection('ALL')" id="tab-ALL">T·∫§T C·∫¢</button>
                <button class="tab-btn" onclick="filterCollection('SE')" id="tab-SE" style="color:#fff; text-shadow:0 0 5px #fff; font-weight:900">SE</button>
                <button class="tab-btn" onclick="filterCollection('UR')" id="tab-UR" style="color:var(--neon-red)">UR</button>
                <button class="tab-btn" onclick="filterCollection('SSR')" id="tab-SSR" style="color:var(--neon-gold)">SSR</button>
                <button class="tab-btn" onclick="filterCollection('SR')" id="tab-SR" style="color:var(--neon-purple)">SR</button>
                <button class="tab-btn" onclick="filterCollection('R')" id="tab-R" style="color:var(--neon-blue)">R</button>
            </div>
            
            <div class="grid-view" id="collectionGrid"></div>
        </div>
        </div>
    </div>

    <div class="modal-overlay" id="historyModal">
        <div class="modal-box">
            <div class="modal-header"><span>L·ªäCH S·ª¨</span><button class="modal-close" onclick="closeModal('historyModal')">√ó</button></div>
            <div class="modal-body"><div class="grid-view" id="historyGrid"></div></div>
        </div>
    </div>
    
    <div class="modal-overlay" id="rechargeModal">
        <div class="modal-box">
            <div class="modal-header">
                <span>C·ª¨A H√ÄNG TINH T√ö</span>
                <button class="modal-close" onclick="closeModal('rechargeModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="recharge-grid">
                    <div class="recharge-item" onclick="buyCoins(5000)">
                        <div class="recharge-icon">üí∞</div>
                        <div class="recharge-amount">5.000 Xu</div>
                        <div class="recharge-price">Free</div>
                    </div>
                    <div class="recharge-item" onclick="buyCoins(50000)">
                        <div class="recharge-icon">üíé</div>
                        <div class="recharge-amount">50.000 Xu</div>
                        <div class="recharge-price">Free</div>
                    </div>
                    
                    <div class="recharge-item" id="pack-100k" onclick="buyCoins(100000)">
                        <div class="recharge-icon">üëë</div>
                        <div class="recharge-amount">100.000 Xu</div>
                        <div class="recharge-price" style="color:var(--neon-gold)">Gi·ªõi h·∫°n: 1 l·∫ßn</div>
                    </div>
                    <div class="recharge-item" id="pack-200k" onclick="buyCoins(200000)">
                        <div class="recharge-icon">ü™ê</div>
                        <div class="recharge-amount">200.000 Xu</div>
                        <div class="recharge-price" style="color:var(--neon-gold)">Gi·ªõi h·∫°n: 1 l·∫ßn</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="giftcodeModal">
        <div class="modal-box" style="max-width:400px; text-align:center">
            <div class="modal-header"><span>GIFTCODE</span><button class="modal-close" onclick="closeModal('giftcodeModal')">√ó</button></div>
            <div class="modal-body">
                <input type="text" id="codeIdx" class="input-code" placeholder="NH·∫¨P M√É">
                <p style="color:#aaa;font-size:0.8rem">Nh·∫≠p m√£ ƒë√™Ãâ nh√¢Ã£n ph√¢ÃÄn th∆∞∆°Ãâng</p>
            </div>
            <button class="action-btn" onclick="redeemCode()">X√ÅC NH·∫¨N</button>
        </div>
    </div>

    <div style="position:absolute; right:20px; top:60px; z-index:49">
         <span onclick="toggleSound()" style="cursor:pointer; background:rgba(0,0,0,0.3); padding:5px 10px; border-radius:20px; font-size:0.8rem; color:white; border:1px solid rgba(255,255,255,0.2)">üîä Nh·∫°c</span>
    </div>

    <div class="modal-overlay" id="completionModal">
        <div class="modal-box complete-box">
            <div class="confetti-bg"></div>
            <div class="modal-body" style="text-align: center; overflow: visible;">
                <h1 class="complete-title">THI√äN H·∫† V√î SONG!</h1>
                <div class="trophy-icon">üèÜ</div>
                <p class="complete-msg">Ch√∫c m·ª´ng! B·∫°n ƒë√£ s∆∞u t·∫≠p ƒë·ªß to√†n b·ªô <span id="total-cards-count">0</span> th·∫ª b√†i!</p>
                <p style="color:#aaa; font-size: 0.9rem; margin-top: 10px;">B·∫°n l√† b·∫≠c th·∫ßy tri·ªáu h·ªìi vƒ© ƒë·∫°i nh·∫•t.</p>
                <button class="action-btn" onclick="closeModal('completionModal')" style="background:var(--neon-gold); border:none; color:#3a2a00; margin-top:30px">NH·∫¨N VINH QUANG</button>
            </div>
        </div>
    </div>
    <script src="script2.js"></script>
</body>
</html>