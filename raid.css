:root {
    --bg-dark: #0f0518;
    --neon-red: #ff2a6d;
    --neon-blue: #05d9e8;
    --neon-green: #39ff14;
    --neon-gold: #ffd700;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    margin: 0; padding: 0;
    background: radial-gradient(circle at bottom, #2b1055 0%, #000 100%);
    color: white; font-family: 'Quicksand', sans-serif;
    height: 100dvh; display: flex; flex-direction: column; overflow: hidden; user-select: none;
}

/* --- CẬP NHẬT HEADER --- */
header {
    height: 45px; display: flex; justify-content: space-between; align-items: center;
    padding: 0 15px; background: rgba(0,0,0,0.8); border-bottom: 1px solid #444; z-index: 10;
}

/* Gom nhóm nút bên trái */
.header-left-group {
    display: flex; gap: 8px; align-items: center;
}

.back-btn { 
    text-decoration: none; color: var(--neon-blue); 
    border: 1px solid var(--neon-blue); padding: 4px 10px; 
    border-radius: 15px; font-size: 0.8rem; font-weight: bold;
    background: transparent; cursor: pointer;
}

/* Style riêng cho nút Menu (Màu Vàng) */
.btn-menu {
    color: var(--neon-gold);
    border-color: var(--neon-gold);
}
.btn-menu:hover {
    background: rgba(255, 215, 0, 0.2);
}

.dps-val { color: var(--neon-gold); font-weight: bold; }

.game-container { flex: 1; display: flex; flex-direction: column; width: 100%; position: relative; }

/* BOSS AREA */
.boss-area {
    flex: 5; display: flex; flex-direction: column; align-items: center; justify-content: center;
    position: relative; width: 100%; padding: 10px 0;
    background: radial-gradient(circle, rgba(255,0,0,0.15) 0%, rgba(0,0,0,0) 80%);
}
.boss-info-overlay { position: absolute; top: 10px; width: 100%; text-align: center; z-index: 2; }
#boss-name { margin: 0; font-family: 'Cinzel', serif; color: var(--neon-red); font-size: 1.5rem; text-shadow: 0 0 10px red; }
#raid-timer { font-size: 2.2rem; font-weight: 900; color: white; text-shadow: 0 0 10px cyan; }
.timer-danger { color: #ff3333 !important; animation: pulse 0.5s infinite; }

.boss-stage { flex: 1; width: 100%; display: flex; align-items: center; justify-content: center; position: relative; }
.boss-img-box {
    width: 45vh; height: 45vh; max-width: 400px; max-height: 400px;
    display: flex; align-items: center; justify-content: center;
    animation: floatBoss 3s ease-in-out infinite;
}
@keyframes floatBoss { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-15px);} }
.boss-img-box img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 0 25px rgba(255,0,0,0.5)); transition: 0.1s; }
.boss-hit img { 
    transform: scale(0.92) translateY(5px); /* Bị đấm lún xuống */
    filter: drop-shadow(0 0 15px #ff3333) !important; /* Viền đỏ nhẹ */
    transition: transform 0.1s cubic-bezier(0.1, 0.7, 1.0, 0.1);
}

.boss-charging img {
    animation: shakeCharge 0.5s infinite;
}
@keyframes shakeCharge {
    0% { transform: translateX(0); }
    25% { transform: translateX(-2px); }
    75% { transform: translateX(2px); }
    100% { transform: translateX(0); }
}

/* Hiệu ứng Boss Heal */
.boss-healing img { filter: drop-shadow(0 0 30px #00ff00) brightness(1.5) !important; transform: scale(1.1); transition: 0.5s; }

/* Thông báo Skill Boss */
#boss-skill-announce {
    position: absolute; top: 20%; width: 100%; text-align: center;
    font-family: 'Cinzel', serif; font-size: 2rem; font-weight: 900;
    text-shadow: 0 0 10px black; opacity: 0; pointer-events: none; z-index: 20;
}
.skill-msg-anim { animation: zoomFade 1.5s forwards; }
@keyframes zoomFade { 0%{transform:scale(0);opacity:0;} 20%{transform:scale(1.2);opacity:1;} 80%{transform:scale(1);opacity:1;} 100%{transform:scale(1.5);opacity:0;} }

.boss-hp-wrapper {
    width: 90%; height: 25px; background: #222; border: 2px solid #fff;
    border-radius: 12px; overflow: hidden; position: relative; margin-bottom: 5px;
    box-shadow: 0 0 15px var(--neon-red); z-index: 5;
}
.hp-bar { height: 100%; background: linear-gradient(90deg, #ff0055, #ff5500); transition: width 0.05s linear; }
.hp-text { position: absolute; top:0; left:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; font-size:0.8rem; font-weight:bold; text-shadow:1px 1px 2px black; }

/* TEAM AREA */
.team-area {
    flex: 2; width: 100%; background: rgba(0,0,0,0.5);
    display: flex; align-items: center; justify-content: center;
    border-top: 1px solid #444; border-bottom: 1px solid #444; padding: 10px;
}
.team-grid { display: flex; gap: 8px; justify-content: center; width: 100%; height: 100%; max-width: 1000px; }

.raid-card {
    flex: 1; background: #1a1a1a; border-radius: 8px; border: 1px solid #555;
    display: flex; flex-direction: column; overflow: hidden;
    position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.5); transition: 0.2s;
}
.raid-card.dead { filter: grayscale(100%) brightness(0.4); border-color: #333 !important; }

/* HIỆU ỨNG CHOÁNG (STUNNED) */
.raid-card.stunned { filter: sepia(1) hue-rotate(200deg) brightness(0.8); border: 2px solid cyan !important; }
.raid-card.stunned::after {
    content: "⚡"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    font-size: 2.5rem; animation: spin 1s infinite linear; z-index: 10;
}
@keyframes spin { 0%{transform:translate(-50%,-50%) rotate(0deg);} 100%{transform:translate(-50%,-50%) rotate(360deg);} }

.card-name { font-size: 0.85rem; font-weight: 800; text-align: center; background: rgba(0,0,0,0.8); color: #fff; padding: 4px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card-img-wrap { flex: 1; position: relative; overflow: hidden; }
.card-img-wrap img { width: 100%; height: 100%; object-fit: cover; }
.card-stats { display: flex; flex-direction: column; justify-content: center; background: rgba(0,0,0,0.95); padding: 4px 5px; font-size: 0.8rem; font-weight: bold; }
.stat-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
.st-atk { color: #ff6b6b; } .st-def { color: #4ecdc4; } .st-spd { color: #ffe66d; }
.mini-hp-bg { width: 100%; height: 8px; background: #333; margin-top: auto; border-top: 1px solid #555; }
.mini-hp-fill { height: 100%; background: #00ff00; transition: width 0.1s linear; }
.hp-val-text { position: absolute; bottom: 8px; left: 0; width: 100%; text-align: center; font-size: 0.7rem; text-shadow: 1px 1px 2px black; font-weight: 900; pointer-events: none; z-index: 2; }

/* CONTROLS */
.controls-area { flex: 1.5; padding: 10px; background: rgba(20, 20, 20, 0.95); min-height: 80px; }
.tactical-grid { display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; gap: 10px; height: 100%; max-width: 800px; margin: 0 auto; }
.tac-btn { border: none; border-radius: 8px; color: white; cursor: pointer; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: flex-start; padding-left: 20px; gap: 15px; font-family: 'Quicksand', sans-serif; box-shadow: 0 4px 0 rgba(0,0,0,0.3); }
.tac-btn:active { transform: translateY(2px); box-shadow: none; }
.tac-btn .icon { font-size: 1.8rem; }
.tac-btn .label { font-weight: 900; font-size: 1.1rem; }
.btn-atk { background: linear-gradient(135deg, #ff416c, #ff4b2b); }
.btn-def { background: linear-gradient(135deg, #2193b0, #6dd5ed); }
.btn-heal { background: linear-gradient(135deg, #11998e, #38ef7d); }
.btn-revive { background: linear-gradient(135deg, #FDC830, #F37335); color: #000; }
.cd-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); transform-origin: bottom; transform: scaleY(0); transition: transform linear; pointer-events: none; }
.cd-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5rem; font-weight: bold; color: white; z-index: 5; }

/* EFFECTS */
#effect-layer { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; }
.float-dmg { position: absolute; font-weight: 900; font-size: 2rem; animation: floatUp 0.8s forwards; text-shadow: 0 0 5px black; color: white; }
@keyframes floatUp { 0%{opacity:1; transform:translate(-50%,-50%);} 100%{opacity:0; transform:translate(-50%,-150%);} }

.hidden { display: none !important; }
#result-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; display: flex; align-items: center; justify-content: center; }
.result-box { background: #222; border: 2px solid gold; padding: 30px; border-radius: 20px; text-align: center; width: 80%; max-width: 400px; }
.result-box h1 { color: gold; margin-top: 0; }
.btn-restart { background: gold; color: black; font-weight: bold; border: none; padding: 12px 30px; border-radius: 25px; margin-top: 15px; cursor: pointer; }

/* ... (Giữ nguyên toàn bộ CSS cũ của phiên bản trước) ... */

/* Thêm vào cuối file raid.css */

/* MODAL CHỌN ĐỘ KHÓ */
#difficulty-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95); z-index: 100;
    display: flex; align-items: center; justify-content: center;
}

.diff-box {
    width: 90%; max-width: 400px;
    display: flex; flex-direction: column; gap: 15px;
    text-align: center;
}
.diff-box h2 { color: white; margin: 0; font-size: 2rem; text-shadow: 0 0 10px white; }
.diff-box p { color: #aaa; margin-bottom: 20px; font-size: 0.9rem; }

.diff-btn {
    border: none; padding: 15px; border-radius: 10px;
    cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
    text-align: left; display: flex; flex-direction: column;
    box-shadow: 0 4px 0 rgba(0,0,0,0.5);
}
.diff-btn:active { transform: translateY(4px); box-shadow: none; }
.diff-btn:hover { filter: brightness(1.2); }

.d-title { font-size: 1.2rem; font-weight: 900; margin-bottom: 2px; }
.d-desc { font-size: 0.8rem; font-weight: bold; opacity: 0.8; }

/* Màu sắc từng độ khó */
.diff-easy { background: linear-gradient(45deg, #11998e, #38ef7d); color: #003300; border: 2px solid #38ef7d; }
.diff-normal { background: linear-gradient(45deg, #2193b0, #6dd5ed); color: #003366; border: 2px solid #6dd5ed; }
.diff-hard { background: linear-gradient(45deg, #FF416C, #FF4B2B); color: white; border: 2px solid #FF416C; }
.diff-hell { background: linear-gradient(45deg, #8E2DE2, #4A00E0); color: white; border: 2px solid #e085ff; box-shadow: 0 0 15px #8E2DE2; }

.hidden { display: none !important; }

/* --- HIỆU ỨNG THẺ BÀI TẤN CÔNG (MỚI) --- */
.card-attack {
    animation: lungeUp 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 0 15px var(--neon-gold) !important;
    border-color: var(--neon-gold) !important;
    z-index: 10;
}

@keyframes lungeUp {
    0% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-15px) scale(1.1); } /* Nảy lên & to ra */
    100% { transform: translateY(0) scale(1); }
}