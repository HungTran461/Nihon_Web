/**
 * NIHONGO CUTE - MAIN SCRIPT
 * Updated: Final Clean Version
 */

/* =========================================
   1. KHO Dá»® LIá»†U (DATABASE)
   ========================================= */

// --- 1.1 Dá»¯ liá»‡u Báº£ng chá»¯ cÃ¡i (Hiragana/Katakana) ---
const charMaps = {
    hiragana: {
        a:'ã‚', i:'ã„', u:'ã†', e:'ãˆ', o:'ãŠ',
        ka:'ã‹', ki:'ã', ku:'ã', ke:'ã‘', ko:'ã“',
        sa:'ã•', shi:'ã—', su:'ã™', se:'ã›', so:'ã',
        ta:'ãŸ', chi:'ã¡', tsu:'ã¤', te:'ã¦', to:'ã¨',
        na:'ãª', ni:'ã«', nu:'ã¬', ne:'ã­', no:'ã®',
        ha:'ã¯', hi:'ã²', fu:'ãµ', he:'ã¸', ho:'ã»',
        ma:'ã¾', mi:'ã¿', mu:'ã‚€', me:'ã‚', mo:'ã‚‚',
        ya:'ã‚„', yu:'ã‚†', yo:'ã‚ˆ',
        ra:'ã‚‰', ri:'ã‚Š', ru:'ã‚‹', re:'ã‚Œ', ro:'ã‚',
        wa:'ã‚', wo:'ã‚’', n:'ã‚“',
        ga:'ãŒ', gi:'ã', gu:'ã', ge:'ã’', go:'ã”',
        za:'ã–', ji:'ã˜', zu:'ãš', ze:'ãœ', zo:'ã',
        da:'ã ', ji_d:'ã¢', zu_d:'ã¥', de:'ã§', do:'ã©',
        ba:'ã°', bi:'ã³', bu:'ã¶', be:'ã¹', bo:'ã¼',
        pa:'ã±', pi:'ã´', pu:'ã·', pe:'ãº', po:'ã½',
        kya:'ãã‚ƒ', kyu:'ãã‚…', kyo:'ãã‚‡', sha:'ã—ã‚ƒ', shu:'ã—ã‚…', sho:'ã—ã‚‡',
        cha:'ã¡ã‚ƒ', chu:'ã¡ã‚…', cho:'ã¡ã‚‡', nya:'ã«ã‚ƒ', nyu:'ã«ã‚…', nyo:'ã«ã‚‡',
        hya:'ã²ã‚ƒ', hyu:'ã²ã‚…', hyo:'ã²ã‚‡', mya:'ã¿ã‚ƒ', myu:'ã¿ã‚…', myo:'ã¿ã‚‡',
        rya:'ã‚Šã‚ƒ', ryu:'ã‚Šã‚…', ryo:'ã‚Šã‚‡', gya:'ãã‚ƒ', gyu:'ãã‚…', gyo:'ãã‚‡',
        ja:'ã˜ã‚ƒ', ju:'ã˜ã‚…', jo:'ã˜ã‚‡', bya:'ã³ã‚ƒ', byu:'ã³ã‚…', byo:'ã³ã‚‡',
        pya:'ã´ã‚ƒ', pyu:'ã´ã‚…', pyo:'ã´ã‚‡'
    },
    katakana: {
        a:'ã‚¢', i:'ã‚¤', u:'ã‚¦', e:'ã‚¨', o:'ã‚ª',
        ka:'ã‚«', ki:'ã‚­', ku:'ã‚¯', ke:'ã‚±', ko:'ã‚³',
        sa:'ã‚µ', shi:'ã‚·', su:'ã‚¹', se:'ã‚»', so:'ã‚½',
        ta:'ã‚¿', chi:'ãƒ', tsu:'ãƒ„', te:'ãƒ†', to:'ãƒˆ',
        na:'ãƒŠ', ni:'ãƒ‹', nu:'ãƒŒ', ne:'ãƒ', no:'ãƒ',
        ha:'ãƒ', hi:'ãƒ’', fu:'ãƒ•', he:'ãƒ˜', ho:'ãƒ›',
        ma:'ãƒ', mi:'ãƒŸ', mu:'ãƒ ', me:'ãƒ¡', mo:'ãƒ¢',
        ya:'ãƒ¤', yu:'ãƒ¦', yo:'ãƒ¨',
        ra:'ãƒ©', ri:'ãƒª', ru:'ãƒ«', re:'ãƒ¬', ro:'ãƒ­',
        wa:'ãƒ¯', wo:'ãƒ²', n:'ãƒ³',
        ga:'ã‚¬', gi:'ã‚®', gu:'ã‚°', ge:'ã‚²', go:'ã‚´',
        za:'ã‚¶', ji:'ã‚¸', zu:'ã‚º', ze:'ã‚¼', zo:'ã‚¾',
        da:'ãƒ€', ji_d:'ãƒ‚', zu_d:'ãƒ…', de:'ãƒ‡', do:'ãƒ‰',
        ba:'ãƒ', bi:'ãƒ“', bu:'ãƒ–', be:'ãƒ™', bo:'ãƒœ',
        pa:'ãƒ‘', pi:'ãƒ”', pu:'ãƒ—', pe:'ãƒš', po:'ãƒ',
        kya:'ã‚­ãƒ£', kyu:'ã‚­ãƒ¥', kyo:'ã‚­ãƒ§', sha:'ã‚·ãƒ£', shu:'ã‚·ãƒ¥', sho:'ã‚·ãƒ§',
        cha:'ãƒãƒ£', chu:'ãƒãƒ¥', cho:'ãƒãƒ§', nya:'ãƒ‹ãƒ£', nyu:'ãƒ‹ãƒ¥', nyo:'ãƒ‹ãƒ§',
        hya:'ãƒ’ãƒ£', hyu:'ãƒ’ãƒ¥', hyo:'ãƒ’ãƒ§', mya:'ãƒŸãƒ£', myu:'ãƒŸãƒ¥', myo:'ãƒŸãƒ§',
        rya:'ãƒªãƒ£', ryu:'ãƒªãƒ¥', ryo:'ãƒªãƒ§', gya:'ã‚®ãƒ£', gyu:'ã‚®ãƒ¥', gyo:'ã‚®ãƒ§',
        ja:'ã‚¸ãƒ£', ju:'ã‚¸ãƒ¥', jo:'ã‚¸ãƒ§', bya:'ãƒ“ãƒ£', byu:'ãƒ“ãƒ¥', byo:'ãƒ“ãƒ§',
        pya:'ãƒ”ãƒ£', pyu:'ãƒ”ãƒ¥', pyo:'ãƒ”ãƒ§'
    }
};

const basicRows = [['a','i','u','e','o'],['ka','ki','ku','ke','ko'],['sa','shi','su','se','so'],['ta','chi','tsu','te','to'],['na','ni','nu','ne','no'],['ha','hi','fu','he','ho'],['ma','mi','mu','me','mo'],['ya','','yu','','yo'],['ra','ri','ru','re','ro'],['wa','','','','wo'],['n','','','','']];
const dakutenRows = [['ga','gi','gu','ge','go'],['za','ji','zu','ze','zo'],['da','ji_d','zu_d','de','do'],['ba','bi','bu','be','bo'],['pa','pi','pu','pe','po']];
const yoonRows = [['kya','kyu','kyo'],['sha','shu','sho'],['cha','chu','cho'],['nya','nyu','nyo'],['hya','hyu','hyo'],['mya','myu','myo'],['rya','ryu','ryo'],['gya','gyu','gyo'],['ja','ju','jo'],['bya','byu','byo'],['pya','pyu','pyo']];

// --- 1.2 Dá»¯ liá»‡u Tá»« vá»±ng gá»£i Ã½ (Hiragana & Katakana) ---
const hiraganaVocab = {
    'a': {j:'ã‚ã‚',v:'ğŸ¬ Káº¹o/MÆ°a'}, 'i': {j:'ã„ã¬',v:'ğŸ• ChÃ³'}, 'u': {j:'ã†ã¿',v:'ğŸŒŠ Biá»ƒn'}, 'e': {j:'ãˆã',v:'ğŸš‰ NhÃ  ga'}, 'o': {j:'ãŠã«ãã‚Š',v:'ğŸ™ CÆ¡m náº¯m'},
    'ka':{j:'ã‹ã•',v:'â˜‚ï¸ Ã”'}, 'ki':{j:'ã',v:'ğŸŒ³ CÃ¢y'}, 'ku':{j:'ãã¤',v:'ğŸ‘Ÿ GiÃ y'}, 'ke':{j:'ã‘ã•',v:'â˜€ï¸ SÃ¡ng nay'}, 'ko':{j:'ã“ã©ã‚‚',v:'ğŸ‘¶ Tráº» em'},
    'sa':{j:'ã•ãã‚‰',v:'ğŸŒ¸ Hoa anh Ä‘Ã o'}, 'shi':{j:'ã—ãŠ',v:'ğŸ§‚ Muá»‘i'}, 'su':{j:'ã™ã—',v:'ğŸ£ Sushi'}, 'se':{j:'ã›ã‚“ã›ã„',v:'ğŸ‘©â€ğŸ« GiÃ¡o viÃªn'}, 'so':{j:'ãã‚‰',v:'â˜ï¸ Báº§u trá»i'},
    'ta':{j:'ãŸã“',v:'ğŸ™ Báº¡ch tuá»™c'}, 'chi':{j:'ã¡ã‹ã¦ã¤',v:'ğŸš‡ TÃ u Ä‘iá»‡n'}, 'tsu':{j:'ã¤ããˆ',v:'ğŸª‘ BÃ n'}, 'te':{j:'ã¦ãŒã¿',v:'âœ‰ï¸ ThÆ°'}, 'to':{j:'ã¨ã‘ã„',v:'â° Äá»“ng há»“'},
    'na':{j:'ãªã¤',v:'â˜€ï¸ MÃ¹a hÃ¨'}, 'ni':{j:'ã«ã',v:'ğŸ¥© Thá»‹t'}, 'nu':{j:'ã¬ã„ãã‚‹ã¿',v:'ğŸ§¸ ThÃº bÃ´ng'}, 'ne':{j:'ã­ã“',v:'ğŸ± MÃ¨o'}, 'no':{j:'ã®ã¿ã‚‚ã®',v:'ğŸ¥¤ Äá»“ uá»‘ng'},
    'ha':{j:'ã¯ãª',v:'ğŸŒº Hoa'}, 'hi':{j:'ã²ã¨',v:'ğŸ§‘ NgÆ°á»i'}, 'fu':{j:'ãµã­',v:'ğŸš¢ Thuyá»n'}, 'he':{j:'ã¸ã‚„',v:'ğŸ  PhÃ²ng'}, 'ho':{j:'ã»ã—',v:'â­ Sao'},
    'ma':{j:'ã¾ã©',v:'ğŸªŸ Cá»­a sá»•'}, 'mi':{j:'ã¿ãš',v:'ğŸ’§ NÆ°á»›c'}, 'mu':{j:'ã‚€ã—',v:'ğŸ› CÃ´n trÃ¹ng'}, 'me':{j:'ã‚',v:'ğŸ‘ï¸ Máº¯t'}, 'mo':{j:'ã‚‚ã‚‚',v:'ğŸ‘ ÄÃ o'},
    'ya':{j:'ã‚„ã¾',v:'â›°ï¸ NÃºi'}, 'yu':{j:'ã‚†ã',v:'â„ï¸ Tuyáº¿t'}, 'yo':{j:'ã‚ˆã‚‹',v:'ğŸŒƒ Tá»‘i'},
    'ra':{j:'ã‚‰ã„ã—ã‚…ã†',v:'ğŸ“… Tuáº§n sau'}, 'ri':{j:'ã‚Šã‚“ã”',v:'ğŸ TÃ¡o'}, 'ru':{j:'ã‚‹ã™',v:'ğŸšª Váº¯ng nhÃ '}, 're':{j:'ã‚Œã„ãã†ã“',v:'ğŸ§Š Tá»§ láº¡nh'}, 'ro':{j:'ã‚ã†ãã',v:'ğŸ•¯ï¸ Náº¿n'},
    'wa':{j:'ã‚ãŸã—',v:'ğŸ™‹ TÃ´i'}, 'wo':{j:'ã‚’',v:'(Trá»£ tá»«)'}, 'n':{j:'ã»ã‚“',v:'ğŸ“š SÃ¡ch'},
    'ga':{j:'ãŒã£ã“ã†',v:'ğŸ« TrÆ°á»ng há»c'}, 'za':{j:'ã–ã£ã—',v:'ğŸ“– Táº¡p chÃ­'}, 'da':{j:'ã ã„ãŒã',v:'ğŸ“ Äáº¡i há»c'}, 'ba':{j:'ã°ã‚‰',v:'ğŸŒ¹ Hoa há»“ng'}, 'pa':{j:'ã±ã‚“',v:'ğŸ BÃ¡nh mÃ¬'},
    'kya':{j:'ãã‚ƒã',v:'ğŸ‘¥ KhÃ¡ch'}, 'sha':{j:'ã—ã‚ƒã—ã‚“',v:'ğŸ“¸ áº¢nh'}, 'cha':{j:'ã¡ã‚ƒã‚ã‚“',v:'ğŸš BÃ¡t cÆ¡m'}, 'nya':{j:'ã«ã‚ƒã‚“ã“',v:'ğŸˆ MÃ¨o con'}
};

const katakanaVocab = {
    'a':{j:'ã‚¢ã‚¤ã‚¹',v:'ğŸ¦ Kem'}, 'i':{j:'ã‚¤ãƒ³ã‚¯',v:'âœ’ï¸ Má»±c'}, 'u':{j:'ã‚¦ã‚¤ã‚¹ã‚­ãƒ¼',v:'ğŸ¥ƒ Whiskey'}, 'e':{j:'ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼',v:'ğŸ›— Thang mÃ¡y'}, 'o':{j:'ã‚ªãƒ¬ãƒ³ã‚¸',v:'ğŸŠ Cam'},
    'ka':{j:'ã‚«ãƒ¡ãƒ©',v:'ğŸ“· Camera'}, 'ki':{j:'ã‚­ã‚¦ã‚¤',v:'ğŸ¥ Kiwi'}, 'ku':{j:'ã‚¯ãƒ©ã‚¹',v:'ğŸ« Lá»›p'}, 'ke':{j:'ã‚±ãƒ¼ã‚­',v:'ğŸ° BÃ¡nh kem'}, 'ko':{j:'ã‚³ãƒ¼ãƒ’ãƒ¼',v:'â˜• CÃ  phÃª'},
    'sa':{j:'ã‚µãƒƒã‚«ãƒ¼',v:'âš½ BÃ³ng Ä‘Ã¡'}, 'shi':{j:'ã‚·ãƒ£ãƒ„',v:'ğŸ‘• SÆ¡ mi'}, 'su':{j:'ã‚¹ãƒãƒ¼ãƒ„',v:'ğŸ… Thá»ƒ thao'}, 'se':{j:'ã‚»ãƒ¼ã‚¿ãƒ¼',v:'ğŸ§¶ Ão len'}, 'so':{j:'ã‚½ãƒ•ã‚¡ãƒ¼',v:'ğŸ›‹ï¸ Sofa'},
    'ta':{j:'ã‚¿ã‚¯ã‚·ãƒ¼',v:'ğŸš• Taxi'}, 'chi':{j:'ãƒãƒ¼ã‚º',v:'ğŸ§€ PhÃ´ mai'}, 'tsu':{j:'ãƒ„ã‚¢ãƒ¼',v:'ğŸš© Tour'}, 'te':{j:'ãƒ†ãƒ‹ã‚¹',v:'ğŸ¾ Tennis'}, 'to':{j:'ãƒˆã‚¤ãƒ¬',v:'ğŸš½ Toilet'},
    'na':{j:'ãƒŠã‚¤ãƒ•',v:'ğŸ´ Dao'}, 'ni':{j:'ãƒ‹ãƒ¥ãƒ¼ã‚¹',v:'ğŸ“° Tin tá»©c'}, 'nu':{j:'ãƒŒãƒ¼ãƒ‰ãƒ«',v:'ğŸœ MÃ¬'}, 'ne':{j:'ãƒã‚¯ã‚¿ã‚¤',v:'ğŸ‘” CÃ  váº¡t'}, 'no':{j:'ãƒãƒ¼ãƒˆ',v:'ğŸ““ Vá»Ÿ'},
    'ha':{j:'ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼',v:'ğŸ” Burger'}, 'hi':{j:'ãƒ’ãƒ¼ã‚¿ãƒ¼',v:'ğŸ”¥ LÃ² sÆ°á»Ÿi'}, 'fu':{j:'ãƒ•ãƒ©ãƒ³ã‚¹',v:'ğŸ‡«ğŸ‡· PhÃ¡p'}, 'he':{j:'ãƒ˜ãƒ«ãƒ¡ãƒƒãƒˆ',v:'â›‘ï¸ MÅ© BH'}, 'ho':{j:'ãƒ›ãƒ†ãƒ«',v:'ğŸ¨ KhÃ¡ch sáº¡n'},
    'ma':{j:'ãƒã‚¹ã‚¯',v:'ğŸ˜· Kháº©u trang'}, 'mi':{j:'ãƒŸãƒ«ã‚¯',v:'ğŸ¥› Sá»¯a'}, 'mu':{j:'ãƒ ãƒ¼ãƒ‰',v:'âœ¨ Mood'}, 'me':{j:'ãƒ¡ãƒ­ãƒ³',v:'ğŸˆ DÆ°a lÆ°á»›i'}, 'mo':{j:'ãƒ¢ãƒ‡ãƒ«',v:'ğŸ’ƒ NgÆ°á»i máº«u'},
    'ya':{j:'ãƒ¤ãƒ³ã‚°',v:'ğŸ‘¶ Tráº»'}, 'yu':{j:'ãƒ¦ãƒ¼ã‚¶ãƒ¼',v:'ğŸ‘¤ User'}, 'yo':{j:'ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ',v:'ğŸ¥£ Sá»¯a chua'},
    'ra':{j:'ãƒ©ã‚¤ã‚ªãƒ³',v:'ğŸ¦ SÆ° tá»­'}, 'ri':{j:'ãƒªãƒœãƒ³',v:'ğŸ€ NÆ¡'}, 'ru':{j:'ãƒ«ãƒ¼ãƒ«',v:'ğŸ“ Rule'}, 're':{j:'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³',v:'ğŸ½ï¸ NhÃ  hÃ ng'}, 'ro':{j:'ãƒ­ãƒœãƒƒãƒˆ',v:'ğŸ¤– Robot'},
    'wa':{j:'ãƒ¯ã‚¤ãƒ³',v:'ğŸ· RÆ°á»£u vang'}, 'wo':{j:'ãƒ²ã‚¿ã‚¯',v:'ğŸ¤“ Otaku'}, 'n':{j:'ãƒ‘ãƒ³',v:'ğŸ BÃ¡nh mÃ¬'},
    'ga':{j:'ã‚¬ãƒ©ã‚¹',v:'ğŸªŸ KÃ­nh'}, 'za':{j:'ã‚¼ãƒ­',v:'0ï¸âƒ£ Sá»‘ 0'}, 'da':{j:'ãƒ€ãƒ³ã‚¹',v:'ğŸ’ƒ Dance'}, 'ba':{j:'ãƒã‚¹',v:'ğŸšŒ Bus'}, 'pa':{j:'ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼',v:'ğŸ‰ Tiá»‡c'}
};

// --- 1.3 Dá»¯ liá»‡u Minna no Nihongo (BÃ i 1 & 2) ---
const minnaData = {
    '1': [
        // --- Äáº¡i tá»« & Con ngÆ°á»i ---
        { k: 'ç§', r: 'ã‚ãŸã—', m: 'TÃ´i' },
        { k: 'ç§ãŸã¡', r: 'ã‚ãŸã—ãŸã¡', m: 'ChÃºng tÃ´i' },
        { k: 'ã‚ãªãŸ', r: 'ã‚ãªãŸ', m: 'Báº¡n / Anh / Chá»‹' },
        { k: 'ã‚ã®äºº', r: 'ã‚ã®ã²ã¨', m: 'NgÆ°á»i kia' },
        { k: 'ã‚ã®æ–¹', r: 'ã‚ã®ã‹ãŸ', m: 'Vá»‹ kia (Lá»‹ch sá»±)' },
        { k: 'ï½ã•ã‚“', r: 'ï½ã•ã‚“', m: 'Ã”ng/BÃ /Anh/Chá»‹ (Háº­u tá»‘)' },
        { k: 'ï½ã¡ã‚ƒã‚“', r: 'ï½ã¡ã‚ƒã‚“', m: 'BÃ© (gÃ¡i)' },
        { k: 'ï½ãã‚“', r: 'ï½ãã‚“', m: 'BÃ© (trai)' },
        { k: 'ï½äºº', r: 'ï½ã˜ã‚“', m: 'NgÆ°á»i nÆ°á»›c ~' },

        // --- Nghá» nghiá»‡p ---
        { k: 'å…ˆç”Ÿ', r: 'ã›ã‚“ã›ã„', m: 'GiÃ¡o viÃªn (Gá»i ngÆ°á»i khÃ¡c)' },
        { k: 'æ•™å¸«', r: 'ãã‚‡ã†ã—', m: 'GiÃ¡o viÃªn (NÃ³i vá» mÃ¬nh)' },
        { k: 'å­¦ç”Ÿ', r: 'ãŒãã›ã„', m: 'Há»c sinh, Sinh viÃªn' },
        { k: 'ä¼šç¤¾å“¡', r: 'ã‹ã„ã—ã‚ƒã„ã‚“', m: 'NhÃ¢n viÃªn cÃ´ng ty' },
        { k: 'ç¤¾å“¡', r: 'ã—ã‚ƒã„ã‚“', m: 'NhÃ¢n viÃªn cÃ´ng ty' },
        { k: 'éŠ€è¡Œå“¡', r: 'ãã‚“ã“ã†ã„ã‚“', m: 'NhÃ¢n viÃªn ngÃ¢n hÃ ng' },
        { k: 'åŒ»è€…', r: 'ã„ã—ã‚ƒ', m: 'BÃ¡c sÄ©' },
        { k: 'ç ”ç©¶è€…', r: 'ã‘ã‚“ãã‚…ã†ã—ã‚ƒ', m: 'NhÃ  nghiÃªn cá»©u' },
        { k: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', r: 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', m: 'Ká»¹ sÆ°' },

        // --- Äá»‹a Ä‘iá»ƒm & KhÃ¡c ---
        { k: 'å¤§å­¦', r: 'ã ã„ãŒã', m: 'TrÆ°á»ng Ä‘áº¡i há»c' },
        { k: 'ç—…é™¢', r: 'ã³ã‚‡ã†ã„ã‚“', m: 'Bá»‡nh viá»‡n' },
        { k: 'é›»æ°—', r: 'ã§ã‚“ã', m: 'Äiá»‡n / ÄÃ¨n Ä‘iá»‡n' },

        // --- Tá»« Ä‘á»ƒ há»i & Tuá»•i ---
        { k: 'ã ã‚Œ', r: 'ã ã‚Œ', m: 'Ai?' },
        { k: 'ã©ãªãŸ', r: 'ã©ãªãŸ', m: 'Vá»‹ nÃ o? (Lá»‹ch sá»±)' },
        { k: 'æ­³', r: 'ï½ã•ã„', m: 'ï½ tuá»•i' },
        { k: 'ä½•æ­³', r: 'ãªã‚“ã•ã„', m: 'Máº¥y tuá»•i?' },
        { k: 'ãŠã„ãã¤', r: 'ãŠã„ãã¤', m: 'Bao nhiÃªu tuá»•i? (Lá»‹ch sá»±)' },

        // --- ChÃ o há»i & Giao tiáº¿p (Ráº¥t quan trá»ng) ---
        { k: 'ã¯ã„', r: 'ã¯ã„', m: 'VÃ¢ng / Dáº¡' },
        { k: 'ã„ã„ãˆ', r: 'ã„ã„ãˆ', m: 'KhÃ´ng' },
        { k: 'å¤±ç¤¼ã§ã™ãŒ', r: 'ã—ã¤ã‚Œã„ã§ã™ãŒ', m: 'Xin cho hoÌ‰i' },
        { k: 'ãŠåå‰ã¯ï¼Ÿ', r: 'ãŠãªã¾ãˆã¯', m: 'TÃªn báº¡n lÃ  gÃ¬?' },
        { k: 'åˆã‚ã¾ã—ã¦', r: 'ã¯ã˜ã‚ã¾ã—ã¦', m: 'ChÃ o láº§n Ä‘áº§u gáº·p' },
        { k: 'ï½ã‹ã‚‰æ¥ã¾ã—ãŸ', r: 'ï½ã‹ã‚‰ãã¾ã—ãŸ', m: 'Äáº¿n tá»« ï½' },
        { k: 'ã©ã†ãã‚ˆã‚ã—ã', r: 'ã©ã†ã ã‚ˆã‚ã—ã', m: 'Ráº¥t mong Ä‘Æ°á»£c giÃºp Ä‘á»¡' },
        { k: 'ãŠé¡˜ã„ã—ã¾ã™', r: 'ãŠã­ãŒã„ã—ã¾ã™', m: 'LÃ m Æ¡n / Nhá» báº¡n' },

        // --- TÃªn cÃ¡c nÆ°á»›c (Katakana) ---
        { k: 'ã‚¢ãƒ¡ãƒªã‚«', r: 'ã‚¢ãƒ¡ãƒªã‚«', m: 'Má»¹' },
        { k: 'ã‚¤ã‚®ãƒªã‚¹', r: 'ã‚¤ã‚®ãƒªã‚¹', m: 'Anh' },
        { k: 'ã‚¤ãƒ³ãƒ‰', r: 'ã‚¤ãƒ³ãƒ‰', m: 'áº¤n Äá»™' },
        { k: 'ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢', r: 'ã‚¤ãƒ³ãƒ‰ãƒã‚·ã‚¢', m: 'Indonesia' },
        { k: 'éŸ“å›½', r: 'ã‹ã‚“ã“ã', m: 'HÃ n Quá»‘c' },
        { k: 'ã‚¿ã‚¤', r: 'ã‚¿ã‚¤', m: 'ThÃ¡i Lan' },
        { k: 'ä¸­å›½', r: 'ã¡ã‚…ã†ã”ã', m: 'Trung Quá»‘c' },
        { k: 'ãƒ‰ã‚¤ãƒ„', r: 'ãƒ‰ã‚¤ãƒ„', m: 'Äá»©c' },
        { k: 'æ—¥æœ¬', r: 'ã«ã»ã‚“', m: 'Nháº­t Báº£n' },
        { k: 'ãƒ•ãƒ©ãƒ³ã‚¹', r: 'ãƒ•ãƒ©ãƒ³ã‚¹', m: 'PhÃ¡p' },
        { k: 'ãƒ–ãƒ©ã‚¸ãƒ«', r: 'ãƒ–ãƒ©ã‚¸ãƒ«', m: 'Brazil' },
        { k: 'ãƒ™ãƒˆãƒŠãƒ ', r: 'ãƒ™ãƒˆãƒŠãƒ ', m: 'Viá»‡t Nam' }
    ],
    '2': [
        { k: 'ã“ã‚Œ', r: 'ã“ã‚Œ', m: 'CÃ¡i nÃ y (gáº§n ngÆ°á»i nÃ³i)' },
        { k: 'ãã‚Œ', r: 'ãã‚Œ', m: 'CÃ¡i Ä‘Ã³ (gáº§n ngÆ°á»i nghe)' },
        { k: 'ã‚ã‚Œ', r: 'ã‚ã‚Œ', m: 'CÃ¡i kia (xa cáº£ hai)' },
        { k: 'ã“ã®ï½', r: 'ã“ã®', m: 'ï½ nÃ y' },
        { k: 'ãã®ï½', r: 'ãã®', m: 'ï½ Ä‘Ã³' },
        { k: 'ã‚ã®ï½', r: 'ã‚ã®', m: 'ï½ kia' },
        { k: 'æœ¬', r: 'ã»ã‚“', m: 'SÃ¡ch' },
        { k: 'è¾æ›¸', r: 'ã˜ã—ã‚‡', m: 'Tá»« Ä‘iá»ƒn' },
        { k: 'é›‘èªŒ', r: 'ã–ã£ã—', m: 'Táº¡p chÃ­' },
        { k: 'æ–°è', r: 'ã—ã‚“ã¶ã‚“', m: 'BÃ¡o' },
        { k: 'ãƒãƒ¼ãƒˆ', r: 'ãƒãƒ¼ãƒˆ', m: 'Vá»Ÿ' },
        { k: 'æ‰‹å¸³', r: 'ã¦ã¡ã‚‡ã†', m: 'Sá»• tay' },
        { k: 'ååˆº', r: 'ã‚ã„ã—', m: 'Danh thiáº¿p' },
        { k: 'ã‚«ãƒ¼ãƒ‰', r: 'ã‚«ãƒ¼ãƒ‰', m: 'Tháº» (Card)' },
        { k: 'é‰›ç­†', r: 'ãˆã‚“ã´ã¤', m: 'BÃºt chÃ¬' },
        { k: 'ãƒœãƒ¼ãƒ«ãƒšãƒ³', r: 'ãƒœãƒ¼ãƒ«ãƒšãƒ³', m: 'BÃºt bi' },
        { k: 'æ™‚è¨ˆ', r: 'ã¨ã‘ã„', m: 'Äá»“ng há»“' },
        { k: 'å‚˜', r: 'ã‹ã•', m: 'CÃ¡i Ã´' },
        { k: 'é„', r: 'ã‹ã°ã‚“', m: 'Cáº·p sÃ¡ch, tÃºi xÃ¡ch' },
        { k: 'ãƒ†ãƒ¼ãƒ—', r: 'ãƒ†ãƒ¼ãƒ—', m: 'BÄƒng cassette/BÄƒng dÃ­nh' },
        { k: 'ãƒ¬ã‚³ãƒ¼ãƒ€ãƒ¼', r: 'ãƒ¬ã‚³ãƒ¼ãƒ€ãƒ¼', m: 'MÃ¡y ghi Ã¢m' },
        { k: 'ãƒ†ãƒ¬ãƒ“', r: 'ãƒ†ãƒ¬ãƒ“', m: 'Tivi' },
        { k: 'ãƒ©ã‚¸ã‚ª', r: 'ãƒ©ã‚¸ã‚ª', m: 'Radio' },
        { k: 'ã‚«ãƒ¡ãƒ©', r: 'ã‚«ãƒ¡ãƒ©', m: 'MÃ¡y áº£nh' },
        { k: 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼', r: 'ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼', m: 'MÃ¡y vi tÃ­nh' },
        { k: 'è‡ªå‹•è»Š', r: 'ã˜ã©ã†ã—ã‚ƒ', m: 'Ã” tÃ´' },
        { k: 'æœº', r: 'ã¤ããˆ', m: 'CÃ¡i bÃ n' },
        { k: 'æ¤…å­', r: 'ã„ã™', m: 'CÃ¡i gháº¿' },
        { k: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ', r: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ', m: 'SÃ´ cÃ´ la' },
        { k: 'ã‚³ãƒ¼ãƒ’ãƒ¼', r: 'ã‚³ãƒ¼ãƒ’ãƒ¼', m: 'CÃ  phÃª' },
        { k: 'è‹±èª', r: 'ãˆã„ã”', m: 'Tiáº¿ng Anh' },
        { k: 'æ—¥æœ¬èª', r: 'ã«ã»ã‚“ã”', m: 'Tiáº¿ng Nháº­t' },
        { k: 'ï½èª', r: 'ï½ã”', m: 'Tiáº¿ng ï½' },
        { k: 'ä½•', r: 'ãªã‚“', m: 'CÃ¡i gÃ¬' },
        { k: 'ãã†ã§ã™', r: 'ãã†ã§ã™', m: 'ÄÃºng rá»“i / Váº­y Ä‘Ã³' }
    ]
};

const n5KanjiData = [
    // --- 1. Sá» Äáº¾M & TIá»€N Tá»† (14 chá»¯) ---
    {c:'ä¸€',h:'NHáº¤T',m:'Má»™t',on:'ICHI',kun:'hito'},
    {c:'äºŒ',h:'NHá»Š',m:'Hai',on:'NI',kun:'futa'},
    {c:'ä¸‰',h:'TAM',m:'Ba',on:'SAN',kun:'mit'},
    {c:'å››',h:'Tá»¨',m:'Bá»‘n',on:'SHI',kun:'yon'},
    {c:'äº”',h:'NGÅ¨',m:'NÄƒm',on:'GO',kun:'itsu'},
    {c:'å…­',h:'Lá»¤C',m:'SÃ¡u',on:'ROKU',kun:'mut'},
    {c:'ä¸ƒ',h:'THáº¤T',m:'Báº£y',on:'SHICHI',kun:'nana'},
    {c:'å…«',h:'BÃT',m:'TÃ¡m',on:'HACHI',kun:'yat'},
    {c:'ä¹',h:'Cá»¬U',m:'ChÃ­n',on:'KYUU',kun:'kokono'},
    {c:'å',h:'THáº¬P',m:'MÆ°á»i',on:'JUU',kun:'tou'},
    {c:'ç™¾',h:'BÃCH',m:'TrÄƒm',on:'HYAKU',kun:'-'},
    {c:'åƒ',h:'THIÃŠN',m:'NghÃ¬n',on:'SEN',kun:'chi'},
    {c:'ä¸‡',h:'Váº N',m:'MÆ°á»i nghÃ¬n',on:'MAN',kun:'-'},
    {c:'å††',h:'YÃŠN',m:'YÃªn / TrÃ²n',on:'EN',kun:'maru'},

    // --- 2. THá»œI GIAN (13 chá»¯) ---
    {c:'æ—¥',h:'NHáº¬T',m:'NgÃ y / Máº·t trá»i',on:'NICHI',kun:'hi'},
    {c:'æœˆ',h:'NGUYá»†T',m:'ThÃ¡ng / Máº·t trÄƒng',on:'GETSU',kun:'tsuki'},
    {c:'ç«',h:'Há»A',m:'Lá»­a / Thá»© 3',on:'KA',kun:'hi'},
    {c:'æ°´',h:'THá»¦Y',m:'NÆ°á»›c / Thá»© 4',on:'SUI',kun:'mizu'},
    {c:'æœ¨',h:'Má»˜C',m:'CÃ¢y / Thá»© 5',on:'MOKU',kun:'ki'},
    {c:'é‡‘',h:'KIM',m:'VÃ ng / Tiá»n / Thá»© 6',on:'KIN',kun:'kane'},
    {c:'åœŸ',h:'THá»”',m:'Äáº¥t / Thá»© 7',on:'DO',kun:'tsuchi'},
    {c:'å¹´',h:'NIÃŠN',m:'NÄƒm',on:'NEN',kun:'toshi'},
    {c:'æ™‚',h:'THá»œI',m:'Giá»',on:'JI',kun:'toki'},
    {c:'åˆ†',h:'PHÃ‚N',m:'PhÃºt / PhÃ¢n chia',on:'FUN',kun:'wa'},
    {c:'åˆ',h:'NGá»Œ',m:'TrÆ°a',on:'GO',kun:'-'},
    {c:'ä»Š',h:'KIM',m:'BÃ¢y giá»',on:'KON',kun:'ima'},
    {c:'åŠ',h:'BÃN',m:'Má»™t ná»­a',on:'HAN',kun:'naka'},

    // --- 3. CON NGÆ¯á»œI & CÆ  THá»‚ (11 chá»¯) ---
    {c:'äºº',h:'NHÃ‚N',m:'NgÆ°á»i',on:'JIN',kun:'hito'},
    {c:'ç”·',h:'NAM',m:'Nam giá»›i',on:'DAN',kun:'otoko'},
    {c:'å¥³',h:'Ná»®',m:'Ná»¯ giá»›i',on:'JO',kun:'onna'},
    {c:'å­',h:'Tá»¬',m:'Tráº» con',on:'SHI',kun:'ko'},
    {c:'çˆ¶',h:'PHá»¤',m:'Bá»‘',on:'FU',kun:'chichi'},
    {c:'æ¯',h:'MáºªU',m:'Máº¹',on:'BO',kun:'haha'},
    {c:'å‹',h:'Há»®U',m:'Báº¡n bÃ¨',on:'YUU',kun:'tomo'},
    {c:'å£',h:'KHáº¨U',m:'Miá»‡ng',on:'KOU',kun:'kuchi'},
    {c:'ç›®',h:'Má»¤C',m:'Máº¯t',on:'MOKU',kun:'me'},
    {c:'è€³',h:'NHÄ¨',m:'Tai',on:'JI',kun:'mimi'},
    {c:'æ‰‹',h:'THá»¦',m:'Tay',on:'SHU',kun:'te'},
    {c:'è¶³',h:'TÃšC',m:'ChÃ¢n',on:'SOKU',kun:'ashi'}, // Bá»• sung cho Ä‘á»§ bá»™ pháº­n

    // --- 4. PHÆ¯Æ NG HÆ¯á»šNG & Vá»Š TRÃ (10 chá»¯) ---
    {c:'ä¸Š',h:'THÆ¯á»¢NG',m:'TrÃªn',on:'JOU',kun:'ue'},
    {c:'ä¸‹',h:'Háº ',m:'DÆ°á»›i',on:'KA',kun:'shita'},
    {c:'å·¦',h:'Táº¢',m:'TrÃ¡i',on:'SA',kun:'hidari'},
    {c:'å³',h:'Há»®U',m:'Pháº£i',on:'U',kun:'migi'},
    {c:'ä¸­',h:'TRUNG',m:'Trong / Giá»¯a',on:'CHUU',kun:'naka'},
    {c:'å¤–',h:'NGOáº I',m:'NgoÃ i',on:'GAI',kun:'soto'},
    {c:'æ±',h:'ÄÃ”NG',m:'PhÃ­a ÄÃ´ng',on:'TOU',kun:'higashi'},
    {c:'è¥¿',h:'TÃ‚Y',m:'PhÃ­a TÃ¢y',on:'SEI',kun:'nishi'},
    {c:'å—',h:'NAM',m:'PhÃ­a Nam',on:'NAN',kun:'minami'},
    {c:'åŒ—',h:'Báº®C',m:'PhÃ­a Báº¯c',on:'HOKU',kun:'kita'},

    // --- 5. Äá»˜NG Tá»ª CÄ‚N Báº¢N (10 chá»¯) ---
    {c:'è¡Œ',h:'HÃ€NH',m:'Äi',on:'KOU',kun:'i'},
    {c:'æ¥',h:'LAI',m:'Äáº¿n',on:'RAI',kun:'ku'},
    {c:'é£Ÿ',h:'THá»°C',m:'Ä‚n',on:'SHOKU',kun:'ta'},
    {c:'é£²',h:'áº¨M',m:'Uá»‘ng',on:'IN',kun:'no'},
    {c:'è¦‹',h:'KIáº¾N',m:'NhÃ¬n',on:'KEN',kun:'mi'},
    {c:'è',h:'VÄ‚N',m:'Nghe',on:'BUN',kun:'ki'},
    {c:'èª­',h:'Äá»˜C',m:'Äá»c',on:'DOKU',kun:'yo'},
    {c:'æ›¸',h:'THÆ¯',m:'Viáº¿t',on:'SHO',kun:'ka'},
    {c:'è©±',h:'THOáº I',m:'NÃ³i chuyá»‡n',on:'WA',kun:'hana'},
    {c:'è²·',h:'MÃƒI',m:'Mua',on:'BAI',kun:'ka'},

    // --- 6. TÃNH Tá»ª CÄ‚N Báº¢N (8 chá»¯) ---
    {c:'å¤§',h:'Äáº I',m:'To lá»›n',on:'DAI',kun:'oo'},
    {c:'å°',h:'TIá»‚U',m:'Nhá» bÃ©',on:'SHOU',kun:'chii'},
    {c:'é«˜',h:'CAO',m:'Cao / Äáº¯t',on:'KOU',kun:'taka'},
    {c:'å®‰',h:'AN',m:'Ráº» / An toÃ n',on:'AN',kun:'yasu'},
    {c:'æ–°',h:'TÃ‚N',m:'Má»›i',on:'SHIN',kun:'atara'},
    {c:'å¤',h:'Cá»”',m:'CÅ©',on:'KO',kun:'furu'},
    {c:'å¤š',h:'ÄA',m:'Nhiá»u',on:'TA',kun:'oo'},
    {c:'å°‘',h:'THIá»‚U',m:'Ãt',on:'SHOU',kun:'suku'},

    // --- 7. THIÃŠN NHIÃŠN & Äá»œI Sá»NG (14 chá»¯) ---
    {c:'å±±',h:'SÆ N',m:'NÃºi',on:'SAN',kun:'yama'},
    {c:'å·',h:'XUYÃŠN',m:'SÃ´ng',on:'SEN',kun:'kawa'},
    {c:'é›¨',h:'VÅ¨',m:'MÆ°a',on:'U',kun:'ame'},
    {c:'èŠ±',h:'HOA',m:'Hoa',on:'KA',kun:'hana'},
    {c:'å¤©',h:'THIÃŠN',m:'Trá»i',on:'TEN',kun:'ama'}, // Thay cho KhÃ­
    {c:'æ°—',h:'KHÃ',m:'Tinh tháº§n/KhÃ­',on:'KI',kun:'-'},
    {c:'å­¦',h:'Há»ŒC',m:'Há»c',on:'GAKU',kun:'mana'},
    {c:'æ ¡',h:'HIá»†U',m:'TrÆ°á»ng há»c',on:'KOU',kun:'-'},
    {c:'æœ¬',h:'Báº¢N',m:'SÃ¡ch / Gá»‘c',on:'HON',kun:'moto'},
    {c:'å',h:'DANH',m:'TÃªn',on:'MEI',kun:'na'},
    {c:'åº—',h:'ÄIáº¾M',m:'Cá»­a hÃ ng',on:'TEN',kun:'mise'},
    {c:'é§…',h:'Dá»ŠCH',m:'NhÃ  ga',on:'EKI',kun:'-'},
    {c:'é›»',h:'ÄIá»†N',m:'Äiá»‡n',on:'DEN',kun:'-'},
    {c:'è»Š',h:'XA',m:'Xe cá»™',on:'SHA',kun:'kuruma'},
    {c:'å›½',h:'QUá»C',m:'Äáº¥t nÆ°á»›c',on:'KOKU',kun:'kuni'},
    {c:'é“',h:'Äáº O',m:'ÄÆ°á»ng',on:'DOU',kun:'michi'}, // Bá»• sung cho Ä‘á»§ 80
    {c:'ç™½',h:'Báº CH',m:'MÃ u tráº¯ng',on:'HAKU',kun:'shiro'},
    {c:'é•·',h:'TRÆ¯á»œNG',m:'DÃ i',on:'CHOU',kun:'naga'}
];

const radicalsData = [
    // --- 1 NÃ‰T (6 bá»™) ---
    {c:'ä¸€', h:'NHáº¤T', m:'Sá»‘ má»™t'},
    {c:'ä¸¨', h:'Cá»”N', m:'NÃ©t sá»• tháº³ng'},
    {c:'ä¸¶', h:'CHá»¦', m:'Äiá»ƒm, cháº¥m'},
    {c:'ä¸¿', h:'PHIá»†T', m:'NÃ©t pháº©y, xiÃªn trÃ¡i'},
    {c:'ä¹™', h:'áº¤T', m:'Can áº¤t, nÃ©t cong'},
    {c:'äº…', h:'QUYáº¾T', m:'NÃ©t mÃ³c'},

    // --- 2 NÃ‰T (23 bá»™) ---
    {c:'äºŒ', h:'NHá»Š', m:'Sá»‘ hai'},
    {c:'äº ', h:'Äáº¦U', m:'Äáº§u, náº¯p, mÃ¡i'},
    {c:'äºº', h:'NHÃ‚N', m:'NgÆ°á»i'},
    {c:'å„¿', h:'NHI', m:'Tráº» con, Ä‘i báº±ng 2 chÃ¢n'},
    {c:'å…¥', h:'NHáº¬P', m:'VÃ o'},
    {c:'å…«', h:'BÃT', m:'Sá»‘ tÃ¡m'},
    {c:'å†‚', h:'QUYNH', m:'VÃ¹ng biÃªn giá»›i, hoang Ä‘á»‹a'},
    {c:'å†–', h:'Má»ŠCH', m:'TrÃ¹m khÄƒn lÃªn'},
    {c:'å†«', h:'BÄ‚NG', m:'NÆ°á»›c Ä‘Ã¡, láº¡nh'},
    {c:'å‡ ', h:'Ká»¶', m:'CÃ¡i gháº¿'},
    {c:'å‡µ', h:'KHáº¢M', m:'HÃ¡ miá»‡ng, há»‘ sÃ¢u'},
    {c:'åˆ€', h:'ÄAO', m:'Con dao, vÅ© khÃ­'},
    {c:'åŠ›', h:'Lá»°C', m:'Sá»©c lá»±c'},
    {c:'å‹¹', h:'BAO', m:'Bao bá»c'},
    {c:'åŒ•', h:'CHá»¦Y', m:'CÃ¡i thÃ¬a (muá»—ng)'},
    {c:'åŒš', h:'PHÆ¯Æ NG', m:'Tá»§ Ä‘á»±ng, váº­t vuÃ´ng'},
    {c:'åŒ¸', h:'Há»†', m:'Che Ä‘áº­y, giáº¥u giáº¿m'},
    {c:'å', h:'THáº¬P', m:'Sá»‘ mÆ°á»i'},
    {c:'åœ', h:'Bá»C', m:'Xem bÃ³i'},
    {c:'å©', h:'TIáº¾T', m:'Äá»‘t tre'},
    {c:'å‚', h:'HÃN', m:'SÆ°á»n nÃºi'},
    {c:'å¶', h:'KHÆ¯', m:'RiÃªng tÆ°'},
    {c:'åˆ', h:'Há»°U', m:'Láº¡i ná»¯a, cÃ¡i tay'},

    // --- 3 NÃ‰T (31 bá»™) ---
    {c:'å£', h:'KHáº¨U', m:'CÃ¡i miá»‡ng'},
    {c:'å›—', h:'VI', m:'VÃ¢y quanh (bá»©c tÆ°á»ng)'},
    {c:'åœŸ', h:'THá»”', m:'Äáº¥t'},
    {c:'å£«', h:'SÄ¨', m:'Káº» sÄ©, ngÆ°á»i cÃ³ há»c'},
    {c:'å¤‚', h:'TRUY', m:'Äáº¿n sau'},
    {c:'å¤Š', h:'TUY', m:'Äi cháº­m'},
    {c:'å¤•', h:'Tá»ŠCH', m:'ÄÃªm tá»‘i'},
    {c:'å¤§', h:'Äáº I', m:'To lá»›n'},
    {c:'å¥³', h:'Ná»®', m:'Phá»¥ ná»¯'},
    {c:'å­', h:'Tá»¬', m:'Con cÃ¡i'},
    {c:'å®€', h:'MIÃŠN', m:'MÃ¡i nhÃ '},
    {c:'å¯¸', h:'THá»N', m:'Táº¥c (Ä‘o lÆ°á»ng), má»™t chÃºt'},
    {c:'å°', h:'TIá»‚U', m:'Nhá» bÃ©'},
    {c:'å°¢', h:'UÃ”NG', m:'Yáº¿u Ä‘uá»‘i, quÃ¨'},
    {c:'å°¸', h:'THI', m:'XÃ¡c cháº¿t'},
    {c:'å±®', h:'TRIá»†T', m:'Máº§m non, cá»'},
    {c:'å±±', h:'SÆ N', m:'NÃºi'},
    {c:'å·›', h:'XUYÃŠN', m:'SÃ´ng ngÃ²i'},
    {c:'å·¥', h:'CÃ”NG', m:'Thá»£, cÃ´ng viá»‡c'},
    {c:'å·±', h:'Ká»¶', m:'Báº£n thÃ¢n'},
    {c:'å·¾', h:'CÃ‚N', m:'CÃ¡i khÄƒn'},
    {c:'å¹²', h:'CAN', m:'Can thiá»‡p, khÃ´, thiÃªn can'},
    {c:'å¹º', h:'YÃŠU', m:'Nhá» nháº¯n, yÃªu á»›t'},
    {c:'å¹¿', h:'NGHIá»„M', m:'MÃ¡i nhÃ  rá»™ng, sÆ°á»n nÃºi'},
    {c:'å»´', h:'DáºªN', m:'BÆ°á»›c dÃ i'},
    {c:'å»¾', h:'Cá»¦NG', m:'Cháº¯p tay (nÃ¢ng váº­t)'},
    {c:'å¼‹', h:'Dáº¶C', m:'Báº¯n tÃªn, cá»c gá»—'},
    {c:'å¼“', h:'CUNG', m:'CÃ¡i cung'},
    {c:'å½', h:'Ká»†', m:'Äáº§u con heo'},
    {c:'å½¡', h:'SAM', m:'LÃ´ng tÃ³c, váº±n'},
    {c:'å½³', h:'XÃCH', m:'BÆ°á»›c chÃ¢n trÃ¡i'},

    // --- 4 NÃ‰T (34 bá»™) ---
    {c:'å¿ƒ', h:'TÃ‚M', m:'Tim, táº¥m lÃ²ng'},
    {c:'æˆˆ', h:'QUA', m:'CÃ¢y giÃ¡o, mÃ¡c'},
    {c:'æˆ¶', h:'Há»˜', m:'Cá»­a má»™t cÃ¡nh'},
    {c:'æ‰‹', h:'THá»¦', m:'Tay'},
    {c:'æ”¯', h:'CHI', m:'CÃ nh cÃ¢y'},
    {c:'æ”´', h:'PHá»˜C', m:'ÄÃ¡nh kháº½'},
    {c:'æ–‡', h:'VÄ‚N', m:'VÄƒn chÆ°Æ¡ng, váº» Ä‘áº¹p'},
    {c:'æ–—', h:'Äáº¨U', m:'CÃ¡i Ä‘áº¥u (Ä‘o lÆ°á»ng)'},
    {c:'æ–¤', h:'CÃ‚N', m:'CÃ¡i rÃ¬u'},
    {c:'æ–¹', h:'PHÆ¯Æ NG', m:'VuÃ´ng, phÆ°Æ¡ng hÆ°á»›ng'},
    {c:'æ— ', h:'VÃ”', m:'KhÃ´ng cÃ³'},
    {c:'æ—¥', h:'NHáº¬T', m:'Máº·t trá»i, ngÃ y'},
    {c:'æ›°', h:'VIáº¾T', m:'NÃ³i ráº±ng'},
    {c:'æœˆ', h:'NGUYá»†T', m:'Máº·t trÄƒng, thÃ¡ng'},
    {c:'æœ¨', h:'Má»˜C', m:'CÃ¢y, gá»—'},
    {c:'æ¬ ', h:'KHIáº¾M', m:'Thiáº¿u, ná»£, khiáº¿m khuyáº¿t'},
    {c:'æ­¢', h:'CHá»ˆ', m:'Dá»«ng láº¡i'},
    {c:'æ­¹', h:'ÄÃƒI', m:'Xáº¥u xa, tá»‡ háº¡i, cháº¿t'},
    {c:'æ®³', h:'THÃ™', m:'Binh khÃ­ dÃ i'},
    {c:'æ¯‹', h:'VÃ”', m:'Chá»›, Ä‘á»«ng (ngÄƒn cáº¥m)'},
    {c:'æ¯”', h:'Tá»¶', m:'So sÃ¡nh'},
    {c:'æ¯›', h:'MAO', m:'LÃ´ng'},
    {c:'æ°', h:'THá»Š', m:'Há» tÃªn, dÃ²ng há»'},
    {c:'æ°”', h:'KHÃ', m:'KhÃ´ng khÃ­, hÆ¡i nÆ°á»›c'},
    {c:'æ°´', h:'THá»¦Y', m:'NÆ°á»›c'},
    {c:'ç«', h:'Há»A', m:'Lá»­a'},
    {c:'çˆª', h:'TRáº¢O', m:'MÃ³ng vuá»‘t'},
    {c:'çˆ¶', h:'PHá»¤', m:'Cha'},
    {c:'çˆ»', h:'HÃ€O', m:'HÃ o (trong bÃ¡t quÃ¡i)'},
    {c:'çˆ¿', h:'TÆ¯á»œNG', m:'Máº£nh gá»— (bÃªn trÃ¡i)'},
    {c:'ç‰‡', h:'PHIáº¾N', m:'Máº£nh, táº¥m (bÃªn pháº£i)'},
    {c:'ç‰›', h:'NGÆ¯U', m:'Con trÃ¢u'},
    {c:'çŠ¬', h:'KHUYá»‚N', m:'Con chÃ³'},

    // --- 5 NÃ‰T (23 bá»™) ---
    {c:'ç„', h:'HUYá»€N', m:'MÃ u Ä‘en, huyá»n bÃ­'},
    {c:'ç‰', h:'NGá»ŒC', m:'ÄÃ¡ quÃ½'},
    {c:'ç“œ', h:'QUA', m:'Quáº£ dÆ°a'},
    {c:'ç“¦', h:'NGÃ•I', m:'ViÃªn ngÃ³i'},
    {c:'ç”˜', h:'CAM', m:'Ngá»t'},
    {c:'ç”Ÿ', h:'SINH', m:'Sinh Ä‘áº», sá»‘ng'},
    {c:'ç”¨', h:'Dá»¤NG', m:'DÃ¹ng'},
    {c:'ç”°', h:'ÄIá»€N', m:'Ruá»™ng'},
    {c:'ç–‹', h:'SÆ ', m:'ÄÆ¡n vá»‹ Ä‘o váº£i, cÃ¡i chÃ¢n'},
    {c:'ç–’', h:'Náº CH', m:'Bá»‡nh táº­t'},
    {c:'ç™¶', h:'BÃT', m:'Gáº¡t ra, bÆ°á»›c Ä‘i'},
    {c:'ç™½', h:'Báº CH', m:'MÃ u tráº¯ng'},
    {c:'çš®', h:'BÃŒ', m:'Da'},
    {c:'çš¿', h:'MÃƒNH', m:'BÃ¡t Ä‘Ä©a'},
    {c:'ç›®', h:'Má»¤C', m:'Máº¯t'},
    {c:'çŸ›', h:'MÃ‚U', m:'CÃ¢y giÃ¡o'},
    {c:'çŸ¢', h:'THá»ˆ', m:'MÅ©i tÃªn'},
    {c:'çŸ³', h:'THáº CH', m:'ÄÃ¡'},
    {c:'ç¤º', h:'THá»Š', m:'Chá»‰ thá»‹, tháº§n Ä‘áº¥t'},
    {c:'ç¦¸', h:'NHá»°U', m:'Váº¿t chÃ¢n thÃº'},
    {c:'ç¦¾', h:'HÃ’A', m:'LÃºa'},
    {c:'ç©´', h:'HUYá»†T', m:'Hang lá»—'},
    {c:'ç«‹', h:'Láº¬P', m:'Äá»©ng'},

    // --- 6 NÃ‰T (29 bá»™) ---
    {c:'ç«¹', h:'TRÃšC', m:'Tre trÃºc'},
    {c:'ç±³', h:'Má»„', m:'Gáº¡o'},
    {c:'ç³¸', h:'Má»ŠCH', m:'Sá»£i tÆ¡'},
    {c:'ç¼¶', h:'PHáºªU', m:'Äá»“ sÃ nh'},
    {c:'ç½‘', h:'VÃ•NG', m:'CÃ¡i lÆ°á»›i'},
    {c:'ç¾Š', h:'DÆ¯Æ NG', m:'Con dÃª'},
    {c:'ç¾½', h:'VÅ¨', m:'LÃ´ng vÅ©'},
    {c:'è€', h:'LÃƒO', m:'GiÃ '},
    {c:'è€Œ', h:'NHI', m:'MÃ , rÃ¢u'},
    {c:'è€’', h:'Lá»–I', m:'CÃ¡i cÃ y'},
    {c:'è€³', h:'NHÄ¨', m:'Tai'},
    {c:'è¿', h:'DUáº¬T', m:'CÃ¢y bÃºt'},
    {c:'è‚‰', h:'NHá»¤C', m:'Thá»‹t'},
    {c:'è‡£', h:'THáº¦N', m:'Bá» tÃ´i'},
    {c:'è‡ª', h:'Tá»°', m:'Tá»± mÃ¬nh'},
    {c:'è‡³', h:'CHÃ', m:'Äáº¿n'},
    {c:'è‡¼', h:'Cá»I', m:'CÃ¡i cá»‘i'},
    {c:'èˆŒ', h:'THIá»†T', m:'CÃ¡i lÆ°á»¡i'},
    {c:'èˆ›', h:'SUYá»„N', m:'Sai láº§m, trÃ¡i ngÆ°á»£c'},
    {c:'èˆŸ', h:'CHU', m:'CÃ¡i thuyá»n'},
    {c:'è‰®', h:'Cáº¤N', m:'Bá»n cá»©ng, quáº» Cáº¥n'},
    {c:'è‰²', h:'Sáº®C', m:'MÃ u sáº¯c'},
    {c:'è‰¸', h:'THáº¢O', m:'Cá»'},
    {c:'è™', h:'HÃ”', m:'Váº±n há»•'},
    {c:'è™«', h:'TRÃ™NG', m:'CÃ´n trÃ¹ng, sÃ¢u bá»'},
    {c:'è¡€', h:'HUYáº¾T', m:'MÃ¡u'},
    {c:'è¡Œ', h:'HÃ€NH', m:'Äi, thi hÃ nh'},
    {c:'è¡£', h:'Y', m:'Ão'},
    {c:'è¥¾', h:'Ã', m:'Che Ä‘áº­y'},

    // --- 7 NÃ‰T (20 bá»™) ---
    {c:'è¦‹', h:'KIáº¾N', m:'NhÃ¬n tháº¥y'},
    {c:'è§’', h:'GIÃC', m:'Sá»«ng, gÃ³c'},
    {c:'è¨€', h:'NGÃ”N', m:'Lá»i nÃ³i'},
    {c:'è°·', h:'Cá»C', m:'Khe suá»‘i, thung lÅ©ng'},
    {c:'è±†', h:'Äáº¬U', m:'Háº¡t Ä‘áº­u, cÃ¡i bÃ¡t'},
    {c:'è±•', h:'THá»ˆ', m:'Con heo'},
    {c:'è±¸', h:'TRÃƒI', m:'LoÃ i sÃ¢u khÃ´ng chÃ¢n'},
    {c:'è²', h:'Bá»I', m:'Vá» sÃ², báº£o bá»‘i, tiá»n'},
    {c:'èµ¤', h:'XÃCH', m:'MÃ u Ä‘á»'},
    {c:'èµ°', h:'Táº¨U', m:'Cháº¡y'},
    {c:'è¶³', h:'TÃšC', m:'ChÃ¢n'},
    {c:'èº«', h:'THÃ‚N', m:'ThÃ¢n thá»ƒ'},
    {c:'è»Š', h:'XA', m:'Xe'},
    {c:'è¾›', h:'TÃ‚N', m:'Cay, váº¥t váº£'},
    {c:'è¾°', h:'THáº¦N', m:'Can Tháº§n, thá»i gian'},
    {c:'è¾µ', h:'SÆ¯á»šC', m:'BÆ°á»›c Ä‘i, chá»£t Ä‘i chá»£t dá»«ng'},
    {c:'é‚‘', h:'áº¤P', m:'VÃ¹ng Ä‘áº¥t, áº¥p'},
    {c:'é…‰', h:'Dáº¬U', m:'Men rÆ°á»£u, can Dáº­u'},
    {c:'é‡†', h:'BIá»†N', m:'PhÃ¢n biá»‡t'},
    {c:'é‡Œ', h:'LÃ', m:'Dáº·m, lÃ ng xÃ³m'},

    // --- 8 NÃ‰T (9 bá»™) ---
    {c:'é‡‘', h:'KIM', m:'VÃ ng, kim loáº¡i'},
    {c:'é•·', h:'TRÆ¯á»œNG', m:'DÃ i, lá»›n'},
    {c:'é–€', h:'MÃ”N', m:'Cá»­a 2 cÃ¡nh'},
    {c:'é˜œ', h:'PHá»¤', m:'Äá»‘ng Ä‘áº¥t, gÃ²'},
    {c:'éš¶', h:'ÄÃƒI', m:'Ká»‹p, theo ká»‹p'},
    {c:'éš¹', h:'CHUY', m:'Chim Ä‘uÃ´i ngáº¯n'},
    {c:'é›¨', h:'VÅ¨', m:'MÆ°a'},
    {c:'é’', h:'THANH', m:'MÃ u xanh'},
    {c:'é', h:'PHI', m:'KhÃ´ng pháº£i'},

    // --- 9 NÃ‰T (11 bá»™) ---
    {c:'é¢', h:'DIá»†N', m:'Máº·t'},
    {c:'é©', h:'CÃCH', m:'Da thÃº (Ä‘Ã£ thuá»™c)'},
    {c:'éŸ‹', h:'VI', m:'Da thuá»™c (má»m)'},
    {c:'éŸ­', h:'Cá»¬U', m:'Rau háº¹'},
    {c:'éŸ³', h:'Ã‚M', m:'Ã‚m thanh'},
    {c:'é ', h:'HIá»†T', m:'Trang giáº¥y, cÃ¡i Ä‘áº§u'},
    {c:'é¢¨', h:'PHONG', m:'GiÃ³'},
    {c:'é£›', h:'PHI', m:'Bay'},
    {c:'é£Ÿ', h:'THá»°C', m:'Ä‚n'},
    {c:'é¦–', h:'THá»¦', m:'Äáº§u'},
    {c:'é¦™', h:'HÆ¯Æ NG', m:'MÃ¹i thÆ¡m'},

    // --- 10 NÃ‰T (8 bá»™) ---
    {c:'é¦¬', h:'MÃƒ', m:'Con ngá»±a'},
    {c:'éª¨', h:'Cá»T', m:'XÆ°Æ¡ng'},
    {c:'é«˜', h:'CAO', m:'Cao'},
    {c:'é«Ÿ', h:'TIÃŠU', m:'TÃ³c dÃ i'},
    {c:'é¬¥', h:'Äáº¤U', m:'ÄÃ¡nh nhau'},
    {c:'é¬¯', h:'SÆ¯á»NG', m:'RÆ°á»£u náº¿p'},
    {c:'é¬²', h:'CÃCH', m:'Ná»“i, Ä‘á»‰nh (náº¥u Äƒn)'},
    {c:'é¬¼', h:'QUá»¶', m:'Con ma'},

    // --- 11 NÃ‰T (6 bá»™) ---
    {c:'é­š', h:'NGÆ¯', m:'Con cÃ¡'},
    {c:'é³¥', h:'ÄIá»‚U', m:'Con chim (Ä‘uÃ´i dÃ i)'},
    {c:'é¹µ', h:'Lá»–', m:'Äáº¥t máº·n'},
    {c:'é¹¿', h:'Lá»˜C', m:'Con hÆ°Æ¡u'},
    {c:'éº¥', h:'Máº CH', m:'LÃºa máº¡ch'},
    {c:'éº»', h:'MA', m:'CÃ¢y gai'},

    // --- 12 NÃ‰T (4 bá»™) ---
    {c:'é»ƒ', h:'HOÃ€NG', m:'MÃ u vÃ ng'},
    {c:'é»', h:'THá»¬', m:'LÃºa náº¿p'},
    {c:'é»‘', h:'Háº®C', m:'MÃ u Ä‘en'},
    {c:'é»¹', h:'CHá»ˆ', m:'May vÃ¡'},

    // --- 13 NÃ‰T (4 bá»™) ---
    {c:'é»½', h:'MÃƒNH', m:'Con áº¿ch'},
    {c:'é¼', h:'Äá»ˆNH', m:'CÃ¡i Ä‘á»‰nh (váº¡c)'},
    {c:'é¼“', h:'Cá»”', m:'CÃ¡i trá»‘ng'},
    {c:'é¼ ', h:'THá»¬', m:'Con chuá»™t'},

    // --- 14 NÃ‰T (2 bá»™) ---
    {c:'é¼»', h:'Tá»´', m:'CÃ¡i mÅ©i'},
    {c:'é½Š', h:'Tá»€', m:'Ngang báº±ng, tá» chá»‰nh'},

    // --- 15 NÃ‰T (1 bá»™) ---
    {c:'é½’', h:'Xá»ˆ', m:'RÄƒng'},

    // --- 16 NÃ‰T (2 bá»™) ---
    {c:'é¾', h:'LONG', m:'Con rá»“ng'},
    {c:'é¾œ', h:'QUY', m:'Con rÃ¹a'},

    // --- 17 NÃ‰T (1 bá»™) ---
    {c:'é¾ ', h:'DÆ¯á»¢C', m:'SÃ¡o 3 lá»—'}
];

const grammarData = {
    '1': [
        {
            title: 'N1 ã¯ N2 ã§ã™ã€‚',
            mean: 'N1 lÃ  N2',
            note: 'DÃ¹ng Ä‘á»ƒ giá»›i thiá»‡u tÃªn, nghá» nghiá»‡p, quá»‘c tá»‹ch. "ã¯" Ä‘á»c lÃ  "wa".',
            ex: [
                { j: 'ã‚ãŸã—ã¯ ãƒã‚¤ã‚¯ãƒ»ãƒŸãƒ©ãƒ¼ã§ã™ã€‚', v: 'TÃ´i lÃ  Mike Miller.' },
                { j: 'ã‚ãŸã—ã¯ ã‹ã„ã—ã‚ƒã„ã‚“ã§ã™ã€‚', v: 'TÃ´i lÃ  nhÃ¢n viÃªn cÃ´ng ty.' }
            ]
        },
        {
            title: 'N1 ã¯ N2 ã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“ / ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚',
            mean: 'N1 khÃ´ng pháº£i lÃ  N2',
            note: 'Phá»§ Ä‘á»‹nh cá»§a "desu". VÄƒn nÃ³i thÆ°á»ng dÃ¹ng "Ja arimasen", vÄƒn viáº¿t dÃ¹ng "Dewa arimasen".',
            ex: [
                { j: 'ã‚µãƒ³ãƒˆã‚¹ã•ã‚“ã¯ ãŒãã›ã„ã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“ã€‚', v: 'Anh Santos khÃ´ng pháº£i lÃ  sinh viÃªn.' },
                { j: 'ã‚ãŸã—ã¯ ã„ã—ã‚ƒã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“ã€‚', v: 'TÃ´i khÃ´ng pháº£i lÃ  bÃ¡c sÄ©.' }
            ]
        },
        {
            title: 'N1 ã¯ N2 ã§ã™ã‹ã€‚',
            mean: 'N1 laÌ€ N2 phaÌ‰i khÃ´ng?',
            note: 'ThÃªm "ka" vÃ o cuá»‘i cÃ¢u khÄƒÌ‰ng Ä‘iÌ£nh Ä‘á»ƒ táº¡o thÃ nh cÃ¢u há»i. LÃªn giá»ng á»Ÿ cuá»‘i cÃ¢u.',
            ex: [
                { j: 'ãƒŸãƒ©ãƒ¼ã•ã‚“ã¯ ã‹ã„ã—ã‚ƒã„ã‚“ã§ã™ã‹ã€‚', v: 'Anh Miller cÃ³ pháº£i lÃ  nhÃ¢n viÃªn cÃ´ng ty khÃ´ng?' },
                { j: '...ã¯ã„ã€ã‹ã„ã—ã‚ƒã„ã‚“ã§ã™ã€‚', v: '...VÃ¢ng, lÃ  nhÃ¢n viÃªn cÃ´ng ty.' }
            ]
        },
        {
            title: 'N ã‚‚',
            mean: 'N cÅ©ng...',
            note: 'DÃ¹ng trá»£ tá»« "mo" thay cho "wa" khi chá»§ Ä‘á» giá»‘ng vá»›i cÃ¢u trÆ°á»›c Ä‘Ã³.',
            ex: [
                { j: 'ãƒŸãƒ©ãƒ¼ã•ã‚“ã¯ ã‹ã„ã—ã‚ƒã„ã‚“ã§ã™ã€‚', v: 'Anh Miller lÃ  nhÃ¢n viÃªn cÃ´ng ty.' },
                { j: 'ã‚°ãƒ—ã‚¿ã•ã‚“ã‚‚ ã‹ã„ã—ã‚ƒã„ã‚“ã§ã™ã€‚', v: 'Anh Gupta cÅ©ng lÃ  nhÃ¢n viÃªn cÃ´ng ty.' }
            ]
        },
        {
            title: 'N1 ã® N2',
            mean: 'N2 cá»§a N1',
            note: 'Trá»£ tá»« "no" ná»‘i 2 danh tá»«. N1 bá»• nghÄ©a cho N2 Ä‘ÃªÌ‰ chiÌ‰ sÆ°Ì£ sÆ¡Ìƒ hÆ°Ìƒu.',
            ex: [
                { j: 'ã‚°ãƒ—ã‚¿ã•ã‚“ã¯ IMCã®ã—ã‚ƒã„ã‚“ã§ã™ã€‚', v: 'Anh Gupta laÌ€ nhÃ¢n viÃªn cuÌ‰a cÃ´ng ty AKC.' },
                { j: 'ãƒ¯ãƒ³ã•ã‚“ã¯ ã“ã†ã¹ã³ã‚‡ã†ã„ã‚“ã®ã„ã—ã‚ƒã§ã™ã€‚', v: 'ChiÌ£ Y laÌ€ baÌc siÌƒ cuÌ‰a bÃªÌ£nh viÃªÌ£n Kobe.' }
            ]
        }
    ],
    '2': [
        {
            title: 'ã“ã‚Œ / ãã‚Œ / ã‚ã‚Œ',
            mean: 'CÃ¡i nÃ y / CÃ¡i Ä‘Ã³ / CÃ¡i kia',
            note: 'Äáº¡i tá»« chá»‰ Ä‘á»‹nh, Ä‘Ã³ng vai trÃ² lÃ  chá»§ ngá»¯. <br>ã“ã‚Œ (Gáº§n ngÆ°á»i nÃ³i), ãã‚Œ (Gáº§n ngÆ°á»i nghe), ã‚ã‚Œ (Xa cáº£ hai).',
            ex: [
                { j: 'ã“ã‚Œã¯ ã˜ã—ã‚‡ã§ã™ã€‚', v: 'CÃ¡i nÃ y lÃ  tá»« Ä‘iá»ƒn.' },
                { j: 'ãã‚Œã¯ ã‚ãŸã—ã® ã‹ã•ã§ã™ã€‚', v: 'CÃ¡i Ä‘Ã³ lÃ  cÃ¡i Ã´ cá»§a tÃ´i.' }
            ]
        },
        {
            title: 'ã“ã® N / ãã® N / ã‚ã® N',
            mean: 'CÃ¡i N nÃ y / CÃ¡i N Ä‘Ã³ / CÃ¡i N kia',
            note: 'Bá»• nghÄ©a cho danh tá»« Ä‘i ngay sau nÃ³.',
            ex: [
                { j: 'ã“ã®ã»ã‚“ã¯ ã‚ãŸã—ã®ã§ã™ã€‚', v: 'Quyá»ƒn sÃ¡ch nÃ y lÃ  cá»§a tÃ´i.' },
                { j: 'ã‚ã®ã‹ãŸã¯ ã©ãªãŸã§ã™ã‹ã€‚', v: 'Vá»‹ kia lÃ  ai váº­y?' }
            ]
        },
        {
            title: 'ãã†ã§ã™ / ãã†ã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“',
            mean: 'ÄÃºng váº­y / KhÃ´ng pháº£i váº­y',
            note: 'DÃ¹ng Ä‘á»ƒ tráº£ lá»i cÃ¢u há»i xÃ¡c nháº­n danh tá»«.',
            ex: [
                { j: 'ãã‚Œã¯ ãƒ†ãƒ¬ãƒ›ãƒ³ã‚«ãƒ¼ãƒ‰ã§ã™ã‹ã€‚', v: 'ÄÃ³ lÃ  tháº» Ä‘iá»‡n thoáº¡i pháº£i khÃ´ng?' },
                { j: '...ã¯ã„ã€ãã†ã§ã™ã€‚', v: '...VÃ¢ng, Ä‘Ãºng váº­y.' }
            ]
        },
        {
            title: 'N1 ã® N2',
            mean: 'N2 thuá»™c vá» N1',
            note: 'Trá»£ tá»« "no" ná»‘i 2 danh tá»«. N1 bá»• nghÄ©a cho N2 Ä‘ÃªÌ‰ chiÌ‰ xuáº¥t xá»©, ná»™i dung...',
            ex: [
                { j: 'ã“ã‚Œã¯ ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã®ã»ã‚“ã§ã™ã€‚', v: 'ÄÃ¢y lÃ  sÃ¡ch vá» mÃ¡y tÃ­nh.' },
                { j: 'ã“ã‚Œã¯ ã‚ãŸã—ã®ã»ã‚“ã§ã™ã€‚', v: 'ÄÃ¢y lÃ  sÃ¡ch cá»§a tÃ´i.' }
            ]
        }
    ]
};


// --- 1.6 Dá»¯ liá»‡u BÃ i táº­p (Exercises) - ÄÃ£ cáº­p nháº­t Ä‘á»‹nh dáº¡ng "Kana(Kanji)" ---
const exercisesData = {
    '1': [
        {
            q: 'ã‚ãŸã—(ç§) ï¼¿ ãƒã‚¤ã‚¯ãƒ»ãƒŸãƒ©ãƒ¼ã§ã™ã€‚(TÃ´i lÃ  Mike Miller.)', 
            opts: ['ã¯', 'ã®', 'ã‚‚'],
            ans: 0 
        },
        {
            q: 'ã‚ã®ã²ã¨(ã‚ã®äºº) ï¼¿ ã©ãªãŸã§ã™ã‹ã€‚(NgÆ°Æ¡Ì€i kia lÃ  ai?)',
            opts: ['ã‚', 'ã¯', 'ãŒ'],
            ans: 1 
        },
        {
            q: 'ã‚†ãŸã•ã‚“ ï¼¿ ãŒãã›ã„(å­¦ç”Ÿ)ã§ã™ã€‚(Yuta cuÌƒng laÌ€ sinh viÃªn.)',
            opts: ['ã¯', 'ã®', 'ã‚‚'], 
            ans: 2 
        },
        {
            q: 'A: ã‚ãŸã—(ç§)ã¯ ãƒ™ãƒˆãƒŠãƒ ã˜ã‚“(äºº)ã§ã™ã€‚<br>B: ã‚°ãƒ—ã‚¿ã•ã‚“ ï¼¿ ãƒ™ãƒˆãƒŠãƒ ã˜ã‚“(äºº)ã§ã™ã‹ã€‚',
            opts: ['ã¯', 'ã®', 'ã‚‚'],
            ans: 2 
        },
        {

            q: 'ã¯ã˜ã‚ã¾ã—ã¦(åˆã‚ã¾ã—ã¦)ã€‚ã©ã†ã ï¼¿ã€‚',
            opts: ['ãŠã­ãŒã„ã—ã¾ã™(ãŠé¡˜ã„ã—ã¾ã™)', 'ã‚ˆã‚ã—ã', 'ã—ã¤ã‚Œã„ã—ã¾ã™(å¤±ç¤¼ã—ã¾ã™)'],
            ans: 1 
        }
    ],
    '2': [
        {
            q: 'ï¼¿ ã¯ ã˜ã—ã‚‡(è¾æ›¸)ã§ã™ã€‚',
            opts: ['ã“ã‚Œ', 'ãã‚Œ', 'ã‚ã‚Œ'],
            ans: 0
        },
        {
            q: 'ãã‚Œã¯ ï¼¿ ã® ã‹ã•(å‚˜)ã§ã™ã‹ã€‚',
            opts: ['ã ã‚Œ(èª°)', 'ãªã‚“(ä½•)', 'ã©ãªãŸ'],
            ans: 0
        },
        {
            q: 'ã“ã® ï¼¿ ã¯ ã‚ãŸã—(ç§)ã®ã§ã™ã€‚',
            opts: ['ã»ã‚“(æœ¬)', 'ã“ã‚Œ', 'ãã‚Œ'],
            ans: 0 
        },
        {

            q: 'ãã†ã§ã™ ï¼¿ã€‚',
            opts: ['ã‹', 'ã­', 'ã˜ã‚ƒã‚ã‚Šã¾ã›ã‚“'],
            ans: 2
        },
        {
            q: 'ã“ã‚Œã¯ ã€Œ9ã€ã§ã™ã‹ã€ã€Œ7ã€ã§ã™ã‹ã€‚<br>...ï¼¿ ã§ã™ã€‚',
            opts: ['ã¯ã„ã€9', 'ã„ã„ãˆã€7', '9'],
            ans: 2 
        }
    ]
};

// --- Dá»¯ liá»‡u Sáº¯p xáº¿p cÃ¢u  ---
const exerciseScrambleData = {
    '1': [
        { 
            question: "TÃ´i lÃ  sinh viÃªn.", 
            parts: ["ã›ã‚“ã›ã„","ã‚ãŸã—", "ã¯", "ãŒãã›ã„", "ã‘ã‚“ãã‚…ã†ã—ã‚ƒ", "ã§ã™", "ã‚ãªãŸ"],
            correct: ["ã‚ãŸã—", "ã¯", "ãŒãã›ã„", "ã§ã™"] 
        },
        { 
            question: "Anh Santos khÃ´ng pháº£i lÃ  giÃ¡o viÃªn.", 
            parts: ["ã¯", "ã›ã‚“ã›ã„", "ã˜ã‚ƒ", "ã‚ã‚Šã¾ã›ã‚“", "ã§ã™ã‹", "ã§ã™", "ã‚µãƒ³ãƒˆã‚¹ã•ã‚“", "ã„ã—ã‚ƒ"],
            correct: ["ã‚µãƒ³ãƒˆã‚¹ã•ã‚“", "ã¯", "ã›ã‚“ã›ã„", "ã˜ã‚ƒ", "ã‚ã‚Šã¾ã›ã‚“"]
        }
    ],
    '2': [
        { 
            question: "CÃ¡i nÃ y lÃ  quyá»ƒn sÃ¡ch.", 
            parts: ["ã“ã‚Œ", "ã¯", "æœ¬", "ã§ã™"],
            correct: ["ã“ã‚Œ", "ã¯", "æœ¬", "ã§ã™"]
        },
        { 
            question: "ÄÃ³ lÃ  cÃ¡i gÃ¬?", 
            parts: ["ãã‚Œ", "ã¯", "ä½•", "ã§ã™ã‹"],
            correct: ["ãã‚Œ", "ã¯", "ä½•", "ã§ã™ã‹"]
        }
    ]
};

const extraData = {
    'school': [
        {k:'æ•™å®¤', r:'ãã‚‡ã†ã—ã¤', m:'Lá»›p há»c'},
        {k:'é£Ÿå ‚', r:'ã—ã‚‡ãã©ã†', m:'NhÃ  Äƒn'},
        {k:'äº‹å‹™æ‰€', r:'ã˜ã‚€ã—ã‚‡', m:'VÄƒn phÃ²ng'},
        {k:'ä¼šè­°å®¤', r:'ã‹ã„ãã—ã¤', m:'PhÃ²ng há»p'},
        {k:'å—ä»˜', r:'ã†ã‘ã¤ã‘', m:'Quáº§y lá»… tÃ¢n'},
        {k:'å»Šä¸‹', r:'ã‚ã†ã‹', m:'HÃ nh lang'},
        {k:'ãƒˆã‚¤ãƒ¬', r:'ãƒˆã‚¤ãƒ¬', m:'NhÃ  vá»‡ sinh'},
        {k:'éšæ®µ', r:'ã‹ã„ã ã‚“', m:'Cáº§u thang'},
        {k:'ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼', r:'ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼', m:'Thang mÃ¡y'},
        {k:'è‡ªå‹•è²©å£²æ©Ÿ', r:'ã˜ã©ã†ã¯ã‚“ã°ã„ã', m:'MÃ¡y bÃ¡n hÃ ng tá»± Ä‘á»™ng'},
        {k:'é»’æ¿', r:'ã“ãã°ã‚“', m:'Báº£ng Ä‘en'},
        {k:'æ¶ˆã—ã‚´ãƒ ', r:'ã‘ã—ã‚´ãƒ ', m:'Cá»¥c táº©y'}
    ],
    'toilet': [
        {k:'ãŠæ‰‹æ´—ã„', r:'ãŠã¦ã‚ã‚‰ã„', m:'NhÃ  vá»‡ sinh (Lá»‹ch sá»±)'},
        {k:'ãƒˆã‚¤ãƒ¬ãƒƒãƒˆãƒšãƒ¼ãƒ‘ãƒ¼', r:'ãƒˆã‚¤ãƒ¬ãƒƒãƒˆãƒšãƒ¼ãƒ‘ãƒ¼', m:'Giáº¥y vá»‡ sinh'},
        {k:'ã‚·ãƒ£ãƒ¯ãƒ¼', r:'ã‚·ãƒ£ãƒ¯ãƒ¼', m:'VÃ²i hoa sen'},
        {k:'ãŠé¢¨å‘‚', r:'ãŠãµã‚', m:'Bá»“n táº¯m'},
        {k:'çŸ³é¹¸', r:'ã›ã£ã‘ã‚“', m:'XÃ  phÃ²ng'},
        {k:'ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼', r:'ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼', m:'Dáº§u gá»™i'},
        {k:'é¡', r:'ã‹ãŒã¿', m:'GÆ°Æ¡ng'},
        {k:'ã‚¿ã‚ªãƒ«', r:'ã‚¿ã‚ªãƒ«', m:'KhÄƒn táº¯m'},
        {k:'æ´—é¢å°', r:'ã›ã‚“ã‚ã‚“ã ã„', m:'Bá»“n rá»­a máº·t'}
    ],
    'time': [
        {k:'ä»Š', r:'ã„ã¾', m:'BÃ¢y giá»'},
        {k:'ï½æ™‚', r:'ï½ã˜', m:'ï½ Giá»'},
        {k:'ï½åˆ†', r:'ï½ãµã‚“', m:'ï½ PhÃºt'},
        {k:'åŠ', r:'ã¯ã‚“', m:'RÆ°á»¡i (30 phÃºt)'},
        {k:'åˆå‰', r:'ã”ãœã‚“', m:'Buá»•i sÃ¡ng (AM)'},
        {k:'åˆå¾Œ', r:'ã”ã”', m:'Buá»•i chiá»u (PM)'},
        {k:'æœ', r:'ã‚ã•', m:'SÃ¡ng'},
        {k:'æ˜¼', r:'ã²ã‚‹', m:'TrÆ°a'},
        {k:'æ™©', r:'ã°ã‚“', m:'Tá»‘i'},
        {k:'æ˜¨æ—¥', r:'ãã®ã†', m:'HÃ´m qua'},
        {k:'ä»Šæ—¥', r:'ãã‚‡ã†', m:'HÃ´m nay'},
        {k:'æ˜æ—¥', r:'ã‚ã—ãŸ', m:'NgÃ y mai'},
        {k:'ä½•æ™‚', r:'ãªã‚“ã˜', m:'Máº¥y giá»'}
    ],
    'week': [
        {k:'æœˆæ›œæ—¥', r:'ã’ã¤ã‚ˆã†ã³', m:'Thá»© 2'},
        {k:'ç«æ›œæ—¥', r:'ã‹ã‚ˆã†ã³', m:'Thá»© 3'},
        {k:'æ°´æ›œæ—¥', r:'ã™ã„ã‚ˆã†ã³', m:'Thá»© 4'},
        {k:'æœ¨æ›œæ—¥', r:'ã‚‚ãã‚ˆã†ã³', m:'Thá»© 5'},
        {k:'é‡‘æ›œæ—¥', r:'ãã‚“ã‚ˆã†ã³', m:'Thá»© 6'},
        {k:'åœŸæ›œæ—¥', r:'ã©ã‚ˆã†ã³', m:'Thá»© 7'},
        {k:'æ—¥æ›œæ—¥', r:'ã«ã¡ã‚ˆã†ã³', m:'Chá»§ nháº­t'},
        {k:'ä½•æ›œæ—¥', r:'ãªã‚“ã‚ˆã†ã³', m:'Thá»© máº¥y'}
    ],
    'number': [ // NhÃ³m Sá»‘ Ä‘áº¿m
        {k:'é›¶', r:'ã‚¼ãƒ­', m:'Sá»‘ 0'},
        {k:'ä¸€', r:'ã„ã¡', m:'Sá»‘ 1'},
        {k:'äºŒ', r:'ã«', m:'Sá»‘ 2'},
        {k:'ä¸‰', r:'ã•ã‚“', m:'Sá»‘ 3'},
        {k:'å››', r:'ã‚ˆã‚“', m:'Sá»‘ 4'},
        {k:'äº”', r:'ã”', m:'Sá»‘ 5'},
        {k:'å…­', r:'ã‚ã', m:'Sá»‘ 6'},
        {k:'ä¸ƒ', r:'ãªãª', m:'Sá»‘ 7'},
        {k:'å…«', r:'ã¯ã¡', m:'Sá»‘ 8'},
        {k:'ä¹', r:'ãã‚…ã†', m:'Sá»‘ 9'},
        {k:'å', r:'ã˜ã‚…ã†', m:'Sá»‘ 10'},
        {k:'ç™¾', r:'ã²ã‚ƒã', m:'SÃ´Ì 100 (TrÄƒm)'},
        {k:'åƒ', r:'ã›ã‚“', m:'SÃ´Ì 1000 (NghÃ¬n)'},
        {k:'ä¸€ä¸‡', r:'ã„ã¡ã¾ã‚“', m:'SÃ´Ì 10.000 (Váº¡n)'}
    ],

    'age': [ // NhÃ³m Tuá»•i tÃ¡c
        {k:'ä¸€æ­³', r:'ã„ã£ã•ã„', m:'1 tuá»•i'},
        {k:'å…«æ­³', r:'ã¯ã£ã•ã„', m:'8 tuá»•i'},
        {k:'åæ­³', r:'ã˜ã‚…ã£ã•ã„', m:'10 tuá»•i'},
        {k:'äºŒåæ­³', r:'ã¯ãŸã¡', m:'20 tuá»•i (Äáº·c biá»‡t)'},
        {k:'ä½•æ­³', r:'ãªã‚“ã•ã„', m:'Máº¥y tuá»•i?'},
        {k:'ãŠã„ãã¤', r:'ãŠã„ãã¤', m:'Bao nhiÃªu tuá»•i (Lá»‹ch sá»±)'}
    ]
};

// --- 1.7 Dá»¯ liá»‡u Há»™i thoáº¡i  ---

const kaiwaData = {
    '1': [ // BÃ i 1 lÃ  má»™t Máº£ng gá»“m nhiá»u há»™i thoáº¡i
        {
            name: 'Kaiwa ChÃ­nh', // TÃªn nÃºt hiá»ƒn thá»‹
            title: 'åˆã‚ã¾ã—ã¦ (Ráº¥t hÃ¢n háº¡nh)',
            img: 'Image/Kaiwa_B1_1.png',
            audio: 'Sound/01_Track_1.mp3',
            dialogue: [
                { role: 'A', name: 'ä½è—¤ (Satou)', text: 'ãŠã¯ã‚ˆã† ã”ã–ã„ã¾ã™ã€‚', mean: 'ChÃ o buá»•i sÃ¡ng.', icon: 'Image/Av_Girl_BlackHair.png', side: 'left', gender: 'female' },
                { role: 'B', name: 'å±±ç”° (Yamada)', text: 'ãŠã¯ã‚ˆã† ã”ã–ã„ã¾ã™ã€‚\nä½è—¤ã•ã‚“ã€ã“ã¡ã‚‰ã¯ ãƒŸãƒ©ãƒ¼ã•ã‚“ã§ã™ã€‚', mean: 'ChÃ o buá»•i sÃ¡ng. Chá»‹ Satou, Ä‘Ã¢y lÃ  anh Miller.', icon: 'Image/Av_Boy_BlackHair.png', side: 'left', gender: 'male'  },
                { role: 'C', name: 'ãƒŸãƒ©ãƒ¼ (Miller)', text: 'åˆã‚ã¾ã—ã¦ã€‚ãƒã‚¤ã‚¯ ãƒŸãƒ©ãƒ¼ã§ã™ã€‚\nã‚¢ãƒ¡ãƒªã‚«ã‹ã‚‰ æ¥ã¾ã—ãŸã€‚\nã©ã†ã ã‚ˆã‚ã—ãã€‚', mean: 'Ráº¥t hÃ¢n háº¡nh. TÃ´i lÃ  Mike Miller. TÃ´i Ä‘áº¿n tá»« Má»¹. Ráº¥t mong Ä‘Æ°á»£c giÃºp Ä‘á»¡.', icon: 'Image/Av_Boy_YellowHair.png', side: 'right' , gender: 'male' },
                { role: 'A', name: 'ä½è—¤ (Satou)', text: 'ä½è—¤ã‘ã„ã“ã§ã™ã€‚\nã©ã†ã ã‚ˆã‚ã—ãã€‚', mean: 'TÃ´i lÃ  Satou Keiko. Ráº¥t mong Ä‘Æ°á»£c giÃºp Ä‘á»¡.', icon: 'Image/Av_Girl_BlackHair.png', side: 'left', gender: 'female'  }
            ]
        },
        {
            name: 'Renshyuu C-2', // Há»™i thoáº¡i phá»¥
            title: 'Há»i tÃªn (ãŠåå‰ã¯)',
            img: 'Image/Kaiwa_B1_2.png',
            audio: '', // KhÃ´ng cÃ³ audio
            dialogue: [
                { role: 'A', name: 'A', text: 'å¤±ç¤¼ã§ã™ãŒã€ãŠåå‰ã¯ï¼Ÿ', mean: 'Xin lá»—i, tÃªn anh/chá»‹ lÃ  gÃ¬?', icon: 'Image/Av_Boy_BlackHair.png',side: 'left' , gender: 'male' },
                { role: 'B', name: 'B', text: 'ã‚¤ãƒ¼ã§ã™ã€‚', mean: 'TÃ´i lÃ  Y.', icon: 'Image/Av_Girl_BlackHair.png',side: 'right', gender: 'female'  },
                { role: 'A', name: 'A', text: 'ãƒªãƒ¼ã•ã‚“ã§ã™ã‹ã€‚', mean: 'BaÌ£n Lee pháº£i khÃ´ng?', icon: 'Image/Av_Boy_BlackHair.png', side: 'left' , gender: 'male' },
                { role: 'B', name: 'B', text: 'ã„ã„ãˆã€ã‚¤ãƒ¼ã§ã™ã€‚', mean: 'KhÃ´ng, lÃ  Y.', icon: 'Image/Av_Girl_BlackHair.png', side: 'right', gender: 'female'  }
            ]
        }
    ],
    '2': [
        {
            name: 'Kaiwa ChÃ­nh',
            title: 'ã»ã‚“ã®æ°—æŒã¡ã§ã™ (ChÃºt lÃ²ng thÃ nh)',
            img: 'Image/Kaiwa_B2_1.png',
            audio: 'Sound/05_Track_5.mp3',
            dialogue: [
                { role: 'A', name: 'å±±ç”° (Yamada)', text: 'ã¯ã„ã€‚ã©ãªãŸã§ã™ã‹ã€‚', mean: 'VÃ¢ng. Ai Ä‘áº¥y áº¡?', icon: 'Image/Av_Boy_BlueHair.png',side: 'left', gender: 'male' },
                { role: 'B', name: 'ã‚µãƒ³ãƒˆã‚¹ (Santos)', text: 'ï¼”ï¼ï¼˜ã® ã‚µãƒ³ãƒˆã‚¹ã§ã™ã€‚', mean: 'TÃ´i lÃ  Santos á»Ÿ phÃ²ng 408.', icon: 'Image/Av_Boy_BlackHair.png', side: 'right', gender: 'male' },
                { role: 'A', name: 'å±±ç”° (Yamada)', text: 'ã“ã‚“ã«ã¡ã¯ã€‚ã‚µãƒ³ãƒˆã‚¹ã•ã‚“ã€‚', mean: 'ChÃ o anh Santos.', icon: 'Image/Av_Boy_BlueHair.png', side: 'left', gender: 'male' },
                { role: 'B', name: 'ã‚µãƒ³ãƒˆã‚¹ (Santos)', text: 'ã“ã‚Œã‹ã‚‰ ãŠä¸–è©±ã« ãªã‚Šã¾ã™ã€‚\nã©ã†ã ã‚ˆã‚ã—ã ãŠé¡˜ã„ã—ã¾ã™ã€‚', mean: 'Tá»« nay mong anh giÃºp Ä‘á»¡. Ráº¥t mong Ä‘Æ°á»£c lÃ m quen.', icon: 'Image/Av_Boy_BlackHair.png', side: 'right', gender: 'male' },
                { role: 'A', name: 'å±±ç”° (Yamada)', text: 'ã“ã¡ã‚‰ã“ã ã‚ˆã‚ã—ãã€‚', mean: 'ChÃ­nh tÃ´i má»›i cáº§n anh giÃºp Ä‘á»¡.', icon: 'Image/Av_Boy_BlueHair.png', side: 'left', gender: 'male' },
                { role: 'B', name: 'ã‚µãƒ³ãƒˆã‚¹ (Santos)', text: 'ã‚ã®ã†ã€ã“ã‚Œã€ã»ã‚“ã®æ°—æŒã¡ã§ã™ã€‚', mean: 'Ã€, cÃ¡i nÃ y... lÃ  chÃºt lÃ²ng thÃ nh.', icon: 'Image/Av_Boy_BlackHair.png', side: 'right', gender: 'male' },
                { role: 'A', name: 'å±±ç”° (Yamada)', text: 'ã‚ã€ã©ã†ã‚‚â€¦â€¦ä½•ã§ã™ã‹ã€‚', mean: 'Ãi chÃ , cáº£m Æ¡n... CÃ¡i gÃ¬ tháº¿?', icon: 'Image/Av_Boy_BlueHair.png', side: 'left', gender: 'male' },
                { role: 'B', name: 'ã‚µãƒ³ãƒˆã‚¹ (Santos)', text: 'ã‚³ãƒ¼ãƒ’ãƒ¼ã§ã™ã€‚ã©ã†ãã€‚', mean: 'LÃ  cÃ  phÃª áº¡. Xin má»i.', icon: 'Image/Av_Boy_BlackHair.png', side: 'right', gender: 'male' },
                { role: 'A', name: 'å±±ç”° (Yamada)', text: 'ã©ã†ã‚‚ ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚', mean: 'Cáº£m Æ¡n anh ráº¥t nhiá»u.', icon: 'Image/Av_Boy_BlueHair.png', side: 'left', gender: 'male' }
            ]
        }
    ]
};
/* =========================================
   2. TRáº NG THÃI & LOGIC ÄIá»€U HÆ¯á»šNG
   ========================================= */

let currentSystem = 'hiragana';
let currentKanjiTab = 'radicals';

// HÃ m má»Ÿ Section duy nháº¥t (Quáº£n lÃ½ toÃ n bá»™ Logic hiá»ƒn thá»‹)
function openSection(id) {
    const mainMenu = document.getElementById('mainMenu');
    const heroSection = document.getElementById('heroSection');
    if (mainMenu) mainMenu.style.display = 'none';
    if (heroSection) heroSection.style.display = 'none';
    
    document.querySelectorAll('.section-content').forEach(s => {
        s.classList.remove('active');
        s.style.display = 'none';
    });
    const target = document.getElementById(id);
    if (target) {
        target.style.display = 'block';
        setTimeout(() => {
            target.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }, 10);
    }
    if (id === 'kanaSection') {
        currentSystem = 'hiragana';
        const container = document.getElementById('gridContainer');
        if (container) container.innerHTML = ''; 
        renderGrid('hiragana');
        resetTabs('#kanaSection', 0);
    }
    else if (id === 'vocabSection') {
        const sel = document.getElementById('lessonSelect');
        if(sel) sel.value = "1";
        renderVocabList("1");
    }
    else if (id === 'kanjiSection') {
        renderKanjiGrid(currentKanjiTab || 'radicals');
        const tabs = document.querySelectorAll('#kanjiSection .tab-btn');
        tabs.forEach(t => t.classList.remove('active'));
        const activeBtn = Array.from(tabs).find(btn => btn.getAttribute('onclick').includes(currentKanjiTab));
        if (activeBtn) activeBtn.classList.add('active');
    }
    else if (id === 'gameSection') {
        switchGameTab('flashcard', { target: document.querySelector('#gameSection .tab-btn') });
    }
    else if (id === 'grammarSection') {
        renderGrammar('1');
        const tabs = document.querySelectorAll('#grammarSection .tab-btn');
        tabs.forEach(t => t.classList.remove('active'));
        if(tabs[0]) tabs[0].classList.add('active');
    }
    else if (id === 'exerciseSection') {
        switchExerciseTab('1');
    }
    if (id === 'kaiwaSection') {
        switchKaiwaTab('1'); 
    }
}

function closeSection() {
    document.querySelectorAll('.section-content').forEach(s => {
        s.classList.remove('active');
        s.style.display = 'none';
    });
    document.getElementById('mainMenu').style.display = 'grid';
    document.getElementById('heroSection').style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function resetTabs(selector, index) {
    const tabs = document.querySelectorAll(selector + ' .tab-btn');
    tabs.forEach(t => t.classList.remove('active'));
    if(tabs[index]) tabs[index].classList.add('active');
}

/* =========================================
   3. LOGIC KANA (Báº¢NG CHá»® CÃI)
   ========================================= */
function switchTab(system, event) {
    currentSystem = system;
    document.querySelectorAll('#kanaSection .tab-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    renderGrid(system);
}

function renderGrid(system) {
    const container = document.getElementById('gridContainer');
    container.innerHTML = ''; 
    createSection(container, 'Ã‚m CÆ¡ Báº£n', basicRows, 'grid-5', system);
    createSection(container, 'Biáº¿n Ã‚m', dakutenRows, 'grid-5', system);
    createSection(container, 'áº¢o Ã‚m', yoonRows, 'grid-3', system);
}

function createSection(container, titleText, dataRows, gridClass, system) {
    const title = document.createElement('div');
    title.className = 'kana-section-title';
    title.innerText = titleText;
    container.appendChild(title);

    const grid = document.createElement('div');
    grid.className = gridClass;

    dataRows.forEach(row => {
        row.forEach(romaji => {
            const box = document.createElement('div');
            box.className = 'kana-box';
            if (!romaji) {
                box.classList.add('empty');
            } else {
                const char = charMaps[system][romaji];
                const display = romaji.replace('_d', '');
                box.innerHTML = `<div class="kana-char">${char}</div><div class="kana-romaji">${display}</div>`;
                box.onclick = () => openModal(char, romaji);
            }
            grid.appendChild(box);
        });
    });
    container.appendChild(grid);
}

/* =========================================
   4. LOGIC Tá»ª Vá»°NG (VOCAB)
   ========================================= */
function changeLesson() {
    const id = document.getElementById('lessonSelect').value;
    renderVocabList(id);
}

function renderVocabList(id) {
    const container = document.getElementById('vocabListContainer');
    container.innerHTML = '';
    const list = minnaData[id] || extraData[id];
    if (list && list.length > 0) {
        list.forEach(word => {
            // Xá»­ lÃ½ hiá»ƒn thá»‹ Kanji (náº¿u giá»‘ng Hiragana thÃ¬ hiá»‡n gáº¡ch ngang)
            const kanjiDisplay = word.k === word.r ? '<span class="no-kanji">-</span>' : word.k;
            
            const row = document.createElement('div');
            row.className = 'vocab-row';
            
            row.innerHTML = `
                <div class="cell-kanji">${kanjiDisplay}</div>
                <div class="cell-reading">${word.r}</div>
                <div class="cell-mean">${word.m}</div>
                <div class="cell-audio">
                    <button class="btn-vocab-speak" onclick="speak('${word.r}')" title="Nghe phÃ¡t Ã¢m">
                        <i class="fas fa-volume-up"></i>
                    </button>
                </div>
            `;
            container.appendChild(row);
        });
    } else {
        container.innerHTML = '<div style="text-align:center; padding:20px; color:#999">ChÆ°a cÃ³ dá»¯ liá»‡u cho má»¥c nÃ y.</div>';
    }
}

/* =========================================
   5. LOGIC HÃN Tá»° (KANJI)
   ========================================= */
function switchKanjiTab(tab, event) {
    currentKanjiTab = tab;
    document.querySelectorAll('#kanjiSection .tab-btn').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
    renderKanjiGrid(tab);
}

function renderKanjiGrid(type) {
    const container = document.getElementById('kanjiListContainer');
    container.innerHTML = '';
    const data = (type === 'n5') ? n5KanjiData : radicalsData;

    data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'kanji-card';
        card.innerHTML = `<div class="k-hanviet">${item.h}</div><div class="k-char">${item.c}</div><div class="k-mean">${item.m}</div>`;
        card.onclick = () => openKanjiModal(item, type);
        container.appendChild(card);
    });
}

function openKanjiModal(item, type) {
    const modal = document.getElementById('charModal');
    const audioBtn = document.querySelector('.btn-audio-large');
    const readingsBox = document.getElementById('kanjiReadings');

    document.getElementById('modalChar').innerText = item.c;
    document.getElementById('modalRomaji').innerText = item.h;

    if (type === 'n5') {
        readingsBox.style.display = 'block';
        document.getElementById('modalOnyomi').innerText = item.on || '-';
        document.getElementById('modalKunyomi').innerText = item.kun || '-';
        if(audioBtn) {
            audioBtn.style.display = 'inline-block';
            audioBtn.onclick = function() {
                speak(item.c); 
            };
        }
        speak(item.c);
    } else {
        readingsBox.style.display = 'none';
        if(audioBtn) audioBtn.style.display = 'none';
    }

    // áº¢nh Stroke Order
    const hex = ('00000' + item.c.charCodeAt(0).toString(16)).slice(-5);
    document.getElementById('strokeImage').src = `https://raw.githubusercontent.com/KanjiVG/kanjivg/master/kanji/${hex}.svg`;
    document.querySelector('.stroke-order-container').style.display = 'block';

    document.getElementById('modalExamples').innerHTML = `<li style="padding:15px">NghÄ©a: <strong>${item.m}</strong></li>`;
    modal.classList.add('show');
}

/* =========================================
   6. MODAL & HELPER (CHUNG)
   ========================================= */
function openModal(char, romaji) {
    const modal = document.getElementById('charModal');
    const audioBtn = document.querySelector('.btn-audio-large');
    if(audioBtn) {
        audioBtn.style.display = 'inline-block';
        audioBtn.onclick = function() {
            speak(char);
        };
    }
    document.getElementById('modalChar').innerText = char;
    document.getElementById('modalRomaji').innerText = romaji.replace('_d', '');
    document.querySelector('.stroke-order-container').style.display = 'none';
    const readingsBox = document.getElementById('kanjiReadings');
    if(readingsBox) readingsBox.style.display = 'none';

    // Data tá»« vá»±ng gá»£i Ã½
    const listEl = document.getElementById('modalExamples');
    listEl.innerHTML = '';
    let wordInfo = (currentSystem === 'hiragana') ? hiraganaVocab[romaji] : katakanaVocab[romaji];

    if(wordInfo) {
        const color = currentSystem === 'hiragana' ? '#ff9a9e' : '#a18cd1';
        listEl.innerHTML = `<li style="padding:15px; border-left:5px solid ${color}"><div style="font-size:1.4rem;color:${color};font-weight:bold">${wordInfo.j}</div><div>${wordInfo.v}</div></li>`;
    } else {
        listEl.innerHTML = '<li style="padding:15px;text-align:center;color:#999">ChÆ°a cÃ³ tá»« vá»±ng gá»£i Ã½.</li>';
    }

    modal.classList.add('show');
    speak(char);
}

function closeModal() {
    document.getElementById('charModal').classList.remove('show');
    window.speechSynthesis.cancel();
}
window.onclick = function(e) {
    if(e.target === document.getElementById('charModal')) closeModal();
}

/* --- THAY THáº¾ HÃ€M speak CÅ¨ Báº°NG HÃ€M NÃ€Y --- */

let voices = [];
// Load danh sÃ¡ch giá»ng khi trÃ¬nh duyá»‡t sáºµn sÃ ng
if (window.speechSynthesis) {
    window.speechSynthesis.onvoiceschanged = () => {
        voices = window.speechSynthesis.getVoices();
    };
}

function speak(text, gender = 'female') {
    if (!('speechSynthesis' in window)) return;

    window.speechSynthesis.cancel(); // Dá»«ng cÃ¢u Ä‘ang nÃ³i dá»Ÿ
    const u = new SpeechSynthesisUtterance(text);
    u.lang = 'ja-JP';
    
    // Cáº­p nháº­t láº¡i danh sÃ¡ch giá»ng náº¿u chÆ°a cÃ³
    if (voices.length === 0) {
        voices = window.speechSynthesis.getVoices();
    }

    // Lá»c ra cÃ¡c giá»ng tiáº¿ng Nháº­t
    const jaVoices = voices.filter(v => v.lang.includes('ja'));

    if (jaVoices.length > 0) {
        // Máº·c Ä‘á»‹nh chá»n giá»ng Ä‘áº§u tiÃªn tÃ¬m tháº¥y
        let selectedVoice = jaVoices[0];

        // LOGIC CHá»ŒN GIá»ŒNG (Heuristic)
        if (gender === 'male') {
            // Cá»‘ tÃ¬m giá»ng cÃ³ tÃªn "Ichiro", "Kenji", "Male"...
            const maleVoice = jaVoices.find(v => 
                v.name.includes('Ichiro') || 
                v.name.includes('Kenji') || 
                v.name.includes('Male') ||
                v.name.includes('Otoya')
            );
            if (maleVoice) selectedVoice = maleVoice;
            
            // Tinh chá»‰nh Ã¢m thanh cho Nam (Tráº§m hÆ¡n)
            u.pitch = 0.8; 
            u.rate = 0.9;  // NÃ³i cháº­m hÆ¡n chÃºt cho giá»‘ng Ä‘Ã n Ã´ng
        } else {
            // Cá»‘ tÃ¬m giá»ng cÃ³ tÃªn "Ayumi", "Haruka", "Kyoko", "Female"...
            const femaleVoice = jaVoices.find(v => 
                v.name.includes('Ayumi') || 
                v.name.includes('Haruka') || 
                v.name.includes('Kyoko') ||
                v.name.includes('Female')
            );
            if (femaleVoice) selectedVoice = femaleVoice;

            // Tinh chá»‰nh Ã¢m thanh cho Ná»¯ (Thanh hÆ¡n)
            u.pitch = 1.1; 
            u.rate = 1.0;
        }

        u.voice = selectedVoice;
    }

    window.speechSynthesis.speak(u);
}

/* =========================================
   7. GAME ENGINE
   ========================================= */
/* --- Thay tháº¿ hÃ m getGameData cÅ© báº±ng hÃ m nÃ y --- */
function getGameData(key) {
    let rawData = [];
    
    // 1. Minna & Saiba
    if (key.startsWith('minna_') || key.startsWith('extra_')) {
        let list = [];
        if (key.startsWith('minna_')) list = minnaData[key.split('_')[1]];
        if (key.startsWith('extra_')) list = extraData[key.split('_')[1]];
        
        if (list) {
            return list.map(i => ({ 
                front: (i.k===i.r?i.r:`${i.r}\n(${i.k})`), // Æ¯u tiÃªn Kana to
                back: i.m, read: i.r, type:'vocab' 
            }));
        }
    }
    
    // 2. Kanji N5
    if (key === 'n5_kanji') {
        return n5KanjiData.map(i => ({ front: i.c, back: `${i.h} - ${i.m}`, read: i.kun!=='-'?i.kun:i.on, type:'kanji' }));
    }

    // 3. KANA & MIX (Logic má»›i)
    // Kiá»ƒm tra cÃ¡c tá»« khÃ³a
    const isHira = key.includes('hira');
    const isKata = key.includes('kata');
    const isMix  = key.includes('mix'); // Má»›i

    if (isHira || isKata || isMix) {
        let rows = [];
        
        // Logic chá»n hÃ ng dá»¯ liá»‡u
        if (key.includes('basic')) rows = basicRows;
        else if (key.includes('daku')) rows = dakutenRows;
        else if (key.includes('yoon')) rows = yoonRows;
        else if (key.includes('full')) rows = [...basicRows, ...dakutenRows, ...yoonRows];
        
        // HÃ m Helper Ä‘á»ƒ push dá»¯ liá»‡u
        const addData = (system, rowList) => {
            const map = charMaps[system];
            rowList.forEach(r => {
                r.forEach(romaji => {
                    if(romaji) {
                        rawData.push({ 
                            front: map[romaji], 
                            back: romaji.replace('_d',''), 
                            read: map[romaji], 
                            type: 'kana' 
                        });
                    }
                });
            });
        };

        // Thá»±c thi dá»±a trÃªn loáº¡i báº£ng
        if (isHira) addData('hiragana', rows);
        if (isKata) addData('katakana', rows);
        if (isMix) {
            // Náº¿u lÃ  Mix thÃ¬ máº·c Ä‘á»‹nh láº¥y Full (hoáº·c tÃ¹y biáº¿n náº¿u muá»‘n)
            // á» Ä‘Ã¢y ta giáº£ Ä‘á»‹nh Mix lÃ  láº¥y Full cáº£ 2 báº£ng
            const fullRows = [...basicRows, ...dakutenRows, ...yoonRows];
            addData('hiragana', fullRows);
            addData('katakana', fullRows);
        }

        return rawData;
    }
    return [];
}

// --- Flashcard Logic ---
let fcList = [], fcIndex = 0, isFlipped = false;
function switchGameTab(tab, event) {
    document.getElementById('gameFlashcardArea').style.display = (tab === 'flashcard') ? 'block' : 'none';
    document.getElementById('gameQuizArea').style.display = (tab === 'quiz') ? 'block' : 'none';
    document.querySelectorAll('#gameSection .tab-btn').forEach(b => b.classList.remove('active'));
    if(event) event.target.classList.add('active');
    if(tab === 'flashcard') initFlashcards();
}

function initFlashcards() {
    const key = document.getElementById('flashcardDeck').value;
    let raw = getGameData(key);
    fcList = raw.sort(() => 0.5 - Math.random()); // Shuffle
    fcIndex = 0;
    renderCard();
}

function renderCard() {
    if(fcList.length === 0) return;
    const item = fcList[fcIndex];
    const card = document.querySelector('.flashcard');
    card.classList.remove('flipped');
    isFlipped = false;

    setTimeout(() => {
        const parts = item.front.split('\n');
        document.getElementById('fcFrontMain').innerText = parts[0];
        document.getElementById('fcFrontSub').innerText = parts[1] || '';
        document.getElementById('fcBackMean').innerText = item.back;
        document.getElementById('fcCounter').innerText = `${fcIndex+1} / ${fcList.length}`;
    }, 200);
}

function flipCard() {
    const card = document.querySelector('.flashcard');
    card.classList.toggle('flipped');
    isFlipped = !isFlipped;
}
function nextCard() { if(fcIndex < fcList.length-1) { fcIndex++; renderCard(); } }
function prevCard() { if(fcIndex > 0) { fcIndex--; renderCard(); } }
function playFlashcardAudio(e) { e.stopPropagation(); speak(fcList[fcIndex].read); }


// --- Quiz Logic ---
let quizList = [], quizIdx = 0, quizScore = 0, quizTimer;
let quizConfig = {time:10, count:10, opts:4};
let quizHistory = [];

function startQuiz() {
    const topic = document.getElementById('quizTopic').value;
    quizConfig.count = parseInt(document.getElementById('quizCount').value);
    quizConfig.time = parseInt(document.getElementById('quizTime').value);
    quizConfig.opts = parseInt(document.getElementById('quizOptionsCount').value);

    const full = getGameData(topic);
    if(full.length < 4) { alert('KhÃ´ng Ä‘á»§ dá»¯ liá»‡u!'); return; }
    quizList = full.sort(() => 0.5 - Math.random()).slice(0, quizConfig.count);
    
    quizIdx = 0; quizScore = 0; quizHistory = [];
    document.getElementById('quizScoreLive').innerText = 0;
    document.getElementById('quizTotal').innerText = quizList.length;
    
    document.getElementById('quizSetup').style.display = 'none';
    document.getElementById('quizPlay').style.display = 'block';
    document.getElementById('quizResult').style.display = 'none';
    loadQuestion();
}

function loadQuestion() {
    if(quizIdx >= quizList.length) { finishQuiz(); return; }
    const q = quizList[quizIdx];
    document.getElementById('quizCurrent').innerText = quizIdx+1;
    
    // Hiá»ƒn thá»‹ Kanji/Kana tÃ¡ch dÃ²ng
    const qEl = document.getElementById('quizQuestion');
    if(q.front.includes('\n')) {
        const p = q.front.split('\n');
        qEl.innerHTML = `<div style="font-size:3rem;line-height:1.1">${p[0]}</div><div style="font-size:1.5rem;color:var(--primary);margin-top:5px">${p[1]}</div>`;
    } else {
        qEl.innerText = q.front;
    }

    // Táº¡o Ä‘Ã¡p Ã¡n
    const grid = document.getElementById('quizOptions');
    grid.innerHTML = '';
    let opts = [q];
    const full = getGameData(document.getElementById('quizTopic').value);
    while(opts.length < quizConfig.opts) {
        const rand = full[Math.floor(Math.random()*full.length)];
        if(!opts.includes(rand) && rand.front !== q.front) opts.push(rand);
    }
    opts.sort(() => 0.5 - Math.random());

    opts.forEach(o => {
        const btn = document.createElement('div');
        btn.className = 'quiz-option';
        btn.innerText = o.back;
        btn.onclick = () => checkAnswer(o, q, btn);
        grid.appendChild(btn);
    });

    runTimer();
}

function runTimer() {
    const bar = document.getElementById('timerBar');
    bar.style.transition = 'none'; bar.style.width = '100%';
    void bar.offsetWidth; // Force reflow
    bar.style.transition = `width ${quizConfig.time}s linear`;
    bar.style.width = '0%';
    
    clearInterval(quizTimer);
    quizTimer = setTimeout(() => recordResult(null, false), quizConfig.time * 1000);
}

function checkAnswer(sel, cor, btn) {
    clearInterval(quizTimer);
    const isRight = (sel.front === cor.front);
    if(isRight) {
        btn.classList.add('correct'); quizScore += 10; speak('ãƒ”ãƒ³ãƒãƒ³');
    } else {
        btn.classList.add('wrong'); speak('ãƒ–ãƒ–ãƒ¼');
        document.querySelectorAll('.quiz-option').forEach(b => {
            if(b.innerText === cor.back) b.classList.add('correct');
        });
    }
    document.querySelectorAll('.quiz-option').forEach(b => b.onclick = null);
    document.getElementById('quizScoreLive').innerText = quizScore;
    setTimeout(() => recordResult(sel, isRight), 1500);
}

function recordResult(sel, isRight) {
    const q = quizList[quizIdx];
    quizHistory.push({
        q: q.front.split('\n')[0],
        correct: q.back,
        user: sel ? sel.back : (sel === null ? 'Háº¿t giá»' : 'ChÆ°a lÃ m'),
        isRight: isRight
    });
    quizIdx++;
    loadQuestion();
}

function endQuizEarly() {
    if(!confirm('Ná»™p bÃ i ngay?')) return;
    clearInterval(quizTimer);
    for(let i=quizIdx; i<quizList.length; i++) {
        const q = quizList[i];
        quizHistory.push({q:q.front.split('\n')[0], correct:q.back, user:'ChÆ°a lÃ m', isRight:false});
    }
    finishQuiz();
}

function finishQuiz() {
    document.getElementById('quizPlay').style.display = 'none';
    document.getElementById('quizResult').style.display = 'block';
    document.getElementById('finalScore').innerText = `${quizScore}Ä‘`;
    
    const list = document.getElementById('resultDetailsList');
    list.innerHTML = '';
    quizHistory.forEach((h,i) => {
        let cls = 'r-wrong';
        if(h.isRight) cls = 'r-correct';
        if(h.user === 'ChÆ°a lÃ m') cls = 'r-skipped';
        
        const item = document.createElement('div');
        item.className = `result-item ${cls}`;
        item.innerHTML = `<div class="r-q-text">CÃ¢u ${i+1}: ${h.q}</div>
                          <div class="r-info"><span class="r-user-ans">Báº¡n: ${h.user}</span>
                          ${!h.isRight ? `<span class="r-right-ans">ÄÃºng: ${h.correct}</span>` : ''}</div>`;
        list.appendChild(item);
    });
}
function resetQuizInfo() {
    document.getElementById('quizResult').style.display = 'none';
    document.getElementById('quizSetup').style.display = 'block';
}

// KHá»I Táº O Máº¶C Äá»ŠNH
window.onload = function() {
    // KhÃ´ng lÃ m gÃ¬ cáº£, chá» ngÆ°á»i dÃ¹ng báº¥m menu
};

/* =========================================
   8. LOGIC NGá»® PHÃP (GRAMMAR)
   ========================================= */


function switchGrammarTab(lessonId, event) {
    // Äá»•i mÃ u nÃºt
    const btns = document.querySelectorAll('#grammarSection .tab-btn');
    btns.forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');

    renderGrammar(lessonId);
}

function renderGrammar(lessonId) {
    const container = document.getElementById('grammarListContainer');
    container.innerHTML = ''; // XÃ³a cÅ©

    const list = grammarData[lessonId];
    if (!list) return;

    list.forEach(item => {
        // Táº¡o HTML cho tá»«ng vÃ­ dá»¥
        let examplesHTML = '';
        item.ex.forEach(e => {
            examplesHTML += `
                <div class="gp-ex-item">
                    <div class="ex-jp"><i class="fas fa-caret-right" style="color:var(--primary)"></i> ${e.j}</div>
                    <div class="ex-vn">${e.v}</div>
                </div>
            `;
        });

        // Táº¡o tháº» Card
        const card = document.createElement('div');
        card.className = 'grammar-card';
        card.innerHTML = `
            <div class="gp-title">${item.title}</div>
            <div class="gp-mean">${item.mean}</div>
            <div class="gp-note">${item.note}</div>
            <div class="gp-examples">
                ${examplesHTML}
            </div>
        `;
        container.appendChild(card);
    });
}

/* =========================================
   9. LOGIC BÃ€I Táº¬P (EXERCISES)
   ========================================= */

let currentExerciseList = [];


// HÃ m di chuyá»ƒn tá»« giá»¯a 2 há»™p
function moveWord(btn) {
    const parent = btn.parentElement;
    const itemContainer = btn.closest('.scramble-item');
    const answerBox = itemContainer.querySelector('.scramble-answer-box');
    const sourceBox = itemContainer.querySelector('.scramble-source-box');

    // Náº¿u Ä‘ang á»Ÿ source -> chuyá»ƒn sang answer
    if (parent === sourceBox) {
        answerBox.appendChild(btn);
    } 
    // Náº¿u Ä‘ang á»Ÿ answer -> chuyá»ƒn vá» source
    else {
        sourceBox.appendChild(btn);
    }
    
    // XÃ³a tráº¡ng thÃ¡i Ä‘Ãºng/sai náº¿u sá»­a láº¡i
    answerBox.classList.remove('correct', 'wrong');
    const feedback = itemContainer.querySelector('.scramble-feedback');
    if(feedback) feedback.innerText = "";
}

function formatText(text) {
    // TÃ¬m Ä‘oáº¡n vÄƒn báº£n dáº¡ng "abc(xyz)" vÃ  bá»c "xyz" vÃ o tháº» span mÃ u xÃ¡m
    return text.replace(/\(([^)]+)\)/g, '<span style="color:#999; font-size:0.9em; font-weight:normal">($1)</span>');
}

function renderExercises(lessonId) {
    const container = document.getElementById('exerciseContainer');
    container.innerHTML = ""; 
    document.getElementById('exerciseScore').innerHTML = ""; 

    // --- PHáº¦N 1: TRáº®C NGHIá»†M ÄIá»€N Tá»ª ---
    const fillData = exercisesData[lessonId]; 
    if (fillData) {
        let html = `<h3 class="part-title">I. Chá»n Ä‘Ã¡p Ã¡n Ä‘Ãºng (mÃ´Ìƒi cÃ¢u Ä‘uÌng Ä‘Æ°Æ¡Ì£c 10 PTS)</h3>`;
        fillData.forEach((item, index) => {
            let optionsHtml = '';
            item.opts.forEach((opt, i) => {
                optionsHtml += `<button class="exercise-opt-btn" onclick="selectOption(this, ${i})">${formatText(opt)}</button>`;
            });

            html += `
                <div class="exercise-item">
                    <p class="exercise-question-text" ><strong>${index + 1}.</strong> ${formatText(item.q)}</p>
                    <div class="exercise-options" id="opts-${index}" data-correct="${item.ans}">
                        ${optionsHtml}
                    </div>
                </div>
            `;
        });
        container.innerHTML += html;
        currentExerciseList = fillData; 
    }

    // --- PHáº¦N 2: Sáº®P Xáº¾P CÃ‚U  ---
    const scrambleData = exerciseScrambleData[lessonId];
    if (scrambleData) {
        let html = `<h3 class="part-title" style="margin-top:30px; border-top:1px dashed #ccc; padding-top:20px;">II. Sáº¯p xáº¿p thÃ nh cÃ¢u hoÃ n chá»‰nh(mÃ´Ìƒi cÃ¢u Ä‘uÌng Ä‘Æ°Æ¡Ì£c 20 PTS)</h3>`;
        scrambleData.forEach((item, index) => {
            const qID = `scramble-${lessonId}-${index}`;
            let shuffled = [...item.parts].sort(() => Math.random() - 0.5);
            let buttonsHtml = shuffled.map(word => 
                `<button class="word-btn" onclick="moveWord(this)">${word}</button>`
            ).join('');

            const correctAnswerStr = JSON.stringify(item.correct).replace(/"/g, '&quot;');

            html += `
                <div class="scramble-item" id="${qID}">
                    <p class="scramble-question"><strong>${index + 1}.</strong> ${formatText(item.question)}</p>
                    <div class="scramble-answer-box" id="${qID}-ans" data-correct="${correctAnswerStr}"></div>
                    <div class="scramble-source-box" id="${qID}-src">${buttonsHtml}</div>
                    <div class="scramble-feedback" style="margin-top:5px; font-weight:bold;"></div>
                </div>
            `;
        });
        container.innerHTML += html;
    }
}

function selectOption(btn, optionIndex) {
    const parent = btn.parentElement;
    
    const allBtns = parent.querySelectorAll('.exercise-opt-btn');
    allBtns.forEach(b => {
        b.classList.remove('selected');
        b.style.background = '#ffffff'; 
        b.style.color = '#555';         
        b.style.borderColor = '#e0e0e0'; 
    });

    btn.classList.add('selected');
    
    btn.style.background = '#f3e5f5'; 
    btn.style.color = '#8e44ad';
    btn.style.borderColor = '#8e44ad';


    parent.setAttribute('data-selected', optionIndex);
}

function switchExerciseTab(lessonId, event) {
    const btn1 = document.getElementById('btn-bai-1');
    const btn2 = document.getElementById('btn-bai-2');
    
    if(btn1) btn1.className = 'tab-btn'; 
    if(btn2) btn2.className = 'tab-btn';

    if (lessonId === '1' && btn1) {
        btn1.className = 'tab-btn active';
    } else if (lessonId === '2' && btn2) {
        btn2.className = 'tab-btn active';
    }
    renderExercises(lessonId);
}

function checkExerciseResult() {
    let score = 0;
    let total = 0;

    if (typeof currentExerciseList !== 'undefined' && currentExerciseList) {
        currentExerciseList.forEach((item, index) => {
            total++;
            const optsDiv = document.getElementById(`opts-${index}`);
            if(optsDiv) {
                const userSelect = optsDiv.getAttribute('data-selected');
                const allBtns = optsDiv.querySelectorAll('.exercise-opt-btn');
                
                // Reset style cÅ©
                allBtns.forEach(b => b.classList.remove('correct', 'wrong'));

                if (userSelect !== null) {
                    if (parseInt(userSelect) === item.ans) {
                        score++;
                        allBtns[userSelect].classList.add('correct');
                        addScore(10); 
                    } else {
                        allBtns[userSelect].classList.add('wrong');
                        allBtns[item.ans].classList.add('correct');
                    }
                } else {
                     allBtns[item.ans].classList.add('correct');
                }
            }
        });
    }

    const scrambleBoxes = document.querySelectorAll('.scramble-answer-box');
    scrambleBoxes.forEach(box => {
        total++;
        const userWords = Array.from(box.querySelectorAll('.word-btn')).map(btn => btn.innerText);
        const correctWords = JSON.parse(box.getAttribute('data-correct'));
        const feedbackDiv = box.parentElement.querySelector('.scramble-feedback');

        if (JSON.stringify(userWords) === JSON.stringify(correctWords)) {
            score++;
            box.classList.add('correct');
            box.classList.remove('wrong');
            feedbackDiv.innerHTML = '<span style="color:#2ecc71"><i class="fas fa-check"></i> ChÃ­nh xÃ¡c!</span>';
            addScore(20);
        } else {
            box.classList.add('wrong');
            box.classList.remove('correct');
            feedbackDiv.innerHTML = '<span style="color:#e74c3c"><i class="fas fa-times"></i> Sai rá»“i</span>';
        }
    });

    const resultDiv = document.getElementById('exerciseScore');
    resultDiv.innerHTML = `Káº¿t quáº£: <strong>${score}/${total}</strong> cÃ¢u Ä‘Ãºng`;
}


/* =========================================
   10. LOGIC Há»˜I THOáº I (KAIWA)
   ========================================= */

let currentKaiwaLesson = '1';

// 1. HÃ m chuyá»ƒn Tab bÃ i há»c (BÃ i 1, BÃ i 2)
function switchKaiwaTab(lessonId, event) {
    // Äá»•i mÃ u nÃºt Tab bÃ i há»c
    const btns = document.querySelectorAll('#kaiwaSection > .kana-tabs .tab-btn');
    btns.forEach(b => b.classList.remove('active'));
    
    // Náº¿u cÃ³ sá»± kiá»‡n click thÃ¬ dÃ¹ng target, náº¿u khÃ´ng (gá»i tá»± Ä‘á»™ng) thÃ¬ tÃ¬m nÃºt tÆ°Æ¡ng á»©ng
    if(event) {
        event.target.classList.add('active');
    } else {
        const index = parseInt(lessonId) - 1; 
        if(btns[index]) btns[index].classList.add('active');
    }
    
    currentKaiwaLesson = lessonId;
    
    renderKaiwaSubNav(lessonId);
}

// 2. HÃ m táº¡o Menu con (Kaiwa ChÃ­nh, Renshuu C...)
function renderKaiwaSubNav(lessonId) {
    const dataList = kaiwaData[lessonId];
    const navContainer = document.getElementById('kaiwaSubNav');
    navContainer.innerHTML = ''; // XÃ³a nÃºt cÅ©

    if (!dataList || dataList.length === 0) {
        document.getElementById('kaiwaContainer').innerHTML = 'ChÆ°a cÃ³ dá»¯ liá»‡u.';
        return;
    }

    // Táº¡o cÃ¡c nÃºt con
    dataList.forEach((item, index) => {
        const btn = document.createElement('button');
        btn.className = 'btn-sub-kaiwa';
        btn.innerText = item.name; 
        btn.onclick = () => renderKaiwaContent(lessonId, index);
        navContainer.appendChild(btn);
    });

    // === QUAN TRá»ŒNG: Tá»° Äá»˜NG LOAD CÃI Äáº¦U TIÃŠN ===
    // Ngay sau khi táº¡o nÃºt xong, gá»i luÃ´n hÃ m hiá»ƒn thá»‹ ná»™i dung sá»‘ 0
    renderKaiwaContent(lessonId, 0);
}

// 3. HÃ m hiá»ƒn thá»‹ ná»™i dung chat
function renderKaiwaContent(lessonId, index) {
    // Highlight nÃºt sub-nav Ä‘ang chá»n
    const btns = document.querySelectorAll('.btn-sub-kaiwa');
    btns.forEach(b => b.classList.remove('active'));
    if(btns[index]) btns[index].classList.add('active');

    // Láº¥y dá»¯ liá»‡u
    const data = kaiwaData[lessonId][index];
    const container = document.getElementById('kaiwaContainer');
    const imgEl = document.getElementById('kaiwaImage');

    // Cáº­p nháº­t áº£nh
    if(data.img) imgEl.src = data.img;
    
    const audioWrapper = document.getElementById('kaiwaAudioPlayer');
    const audioEl = document.getElementById('kaiwaAudio');
    const btnIcon = document.getElementById('kaiwaAudioIcon');
    const btnText = document.getElementById('kaiwaAudioText');
    const btnMain = document.getElementById('btnKaiwaAudio');

    // Reset tráº¡ng thÃ¡i
    if (audioEl) {
        audioEl.pause();
        audioEl.currentTime = 0;
    }
    if (btnIcon) btnIcon.className = 'fas fa-play';
    if (btnText) btnText.innerText = 'Nghe CD';
    if (btnMain) btnMain.classList.remove('playing');

    // Náº¡p file nháº¡c má»›i (Láº¥y tá»« data con)
    if (audioWrapper && audioEl) {
        if (data.audio && data.audio !== "") {
            audioEl.src = data.audio;
            audioWrapper.style.display = 'flex'; // Hiá»‡n nÃºt
        } else {
            audioWrapper.style.display = 'none'; // áº¨n nÃºt náº¿u bÃ i nÃ y (vd: Renshuu C) khÃ´ng cÃ³ tiáº¿ng
        }
    }

    container.innerHTML = ''; // XÃ³a chat cÅ©

    // Render tá»«ng dÃ²ng chat
    data.dialogue.forEach(line => {
        const row = document.createElement('div');
        
        const isRight = (line.side === 'right');
        // ==============================
        
        row.className = `chat-row ${isRight ? 'right' : 'left'}`;
        
        row.innerHTML = `
            <img src="${line.icon}" class="chat-avatar" alt="${line.name}">
            <div class="chat-bubble">
                <div class="chat-name">${line.name}</div>
                <div class="chat-jp">
                    ${line.text.replace(/\n/g, '<br>')} 
                    
                    <i class="fas fa-volume-up btn-chat-audio" 
                    onclick="speak('${line.text.replace(/\n/g, ' ')}', '${line.gender || 'female'}')">
                    </i>

                </div>
                <div class="chat-vn">${line.mean}</div>
            </div>
        `;
        container.appendChild(row);
    });
}

/* --- LOGIC AUDIO KAIWA --- */
function toggleKaiwaAudio() {
    const audio = document.getElementById('kaiwaAudio');
    const btn = document.getElementById('btnKaiwaAudio');
    const icon = document.getElementById('kaiwaAudioIcon');
    const text = document.getElementById('kaiwaAudioText');

    if (audio.paused) {
        // Äang dá»«ng -> Báº¥m Ä‘á»ƒ phÃ¡t
        audio.play();
        btn.classList.add('playing');
        icon.className = 'fas fa-pause';
        text.innerText = "Äang phÃ¡t...";
    } else {
        // Äang phÃ¡t -> Báº¥m Ä‘á»ƒ dá»«ng
        audio.pause();
        btn.classList.remove('playing');
        icon.className = 'fas fa-play';
        text.innerText = "Nghe CD";
    }
}

// Khi nháº¡c cháº¡y háº¿t thÃ¬ tá»± Ä‘á»™ng reset nÃºt vá» ban Ä‘áº§u
document.getElementById('kaiwaAudio').addEventListener('ended', function() {
    const btn = document.getElementById('btnKaiwaAudio');
    const icon = document.getElementById('kaiwaAudioIcon');
    const text = document.getElementById('kaiwaAudioText');
    
    btn.classList.remove('playing');
    icon.className = 'fas fa-play';
    text.innerText = "Nghe láº¡i";
});


/* =========================================
   11. GAME PHáº¢N Xáº  (REFLEX)
   ========================================= */

let reflexTimer = null;
let reflexDataList = [];

function switchGameTab(tab, event) {
    // 1. áº¨n táº¥t cáº£ cÃ¡c khu vá»±c game
    document.getElementById('gameFlashcardArea').style.display = 'none';
    document.getElementById('gameQuizArea').style.display = 'none';
    document.getElementById('gameReflexArea').style.display = 'none';
    
    // 2. Hiá»ƒn thá»‹ khu vá»±c Ä‘Æ°á»£c chá»n
    if (tab === 'flashcard') document.getElementById('gameFlashcardArea').style.display = 'block';
    if (tab === 'quiz') document.getElementById('gameQuizArea').style.display = 'block';
    if (tab === 'reflex') document.getElementById('gameReflexArea').style.display = 'block';

    // 3. Äá»•i mÃ u nÃºt Tab
    document.querySelectorAll('#gameSection .tab-btn').forEach(b => b.classList.remove('active'));
    if(event) event.target.classList.add('active');
    
    // Dá»«ng game pháº£n xáº¡ náº¿u Ä‘ang cháº¡y mÃ  chuyá»ƒn tab
    if (tab !== 'reflex') stopReflexGame();
    if (tab === 'flashcard') initFlashcards();
}

function startReflexGame() {
    const topic = document.getElementById('reflexTopic').value;
    const speed = parseInt(document.getElementById('reflexSpeed').value);
    
    // Láº¥y dá»¯ liá»‡u
    reflexDataList = getGameData(topic);
    
    if (reflexDataList.length === 0) {
        alert("ChÆ°a cÃ³ dá»¯ liá»‡u!");
        return;
    }

    // Chuyá»ƒn giao diá»‡n
    document.getElementById('reflexSetup').style.display = 'none';
    document.getElementById('reflexPlay').style.display = 'block';

    // Báº¯t Ä‘áº§u vÃ²ng láº·p
    runReflexLoop(speed);
}

function runReflexLoop(speed) {
    // Hiá»ƒn thá»‹ chá»¯ Ä‘áº§u tiÃªn ngay láº­p tá»©c
    showRandomReflexChar();

    // CÃ i Ä‘áº·t láº·p láº¡i
    reflexTimer = setInterval(() => {
        showRandomReflexChar();
    }, speed);
}

function showRandomReflexChar() {
    const charEl = document.getElementById('reflexChar');
    const romajiEl = document.getElementById('reflexRomaji');
    
    // Láº¥y ngáº«u nhiÃªn
    const randomItem = reflexDataList[Math.floor(Math.random() * reflexDataList.length)];
    
    // GÃ¡n ná»™i dung
    charEl.innerText = randomItem.front;
    romajiEl.innerText = randomItem.back; // Romaji
    
    // ThÃªm hiá»‡u á»©ng animation
    charEl.classList.remove('animate-pop');
    void charEl.offsetWidth; // Trigger reflow Ä‘á»ƒ cháº¡y láº¡i animation
    charEl.classList.add('animate-pop');
    
    // Äá»•i mÃ u ngáº«u nhiÃªn cho sinh Ä‘á»™ng (Optional)
    const colors = ['#ff9a9e', '#a18cd1', '#333', '#fbc2eb', '#4facfe'];
    charEl.style.color = colors[Math.floor(Math.random() * colors.length)];
}

function stopReflexGame() {
    clearInterval(reflexTimer);
    document.getElementById('reflexSetup').style.display = 'flex'; // Flex Ä‘á»ƒ cÄƒn giá»¯a do CSS cÅ©
    document.getElementById('reflexPlay').style.display = 'none';
}

/* =========================================
   LOGIC Báº¢NG Xáº¾P Háº NG (LEADERBOARD)
   ========================================= */

// 1. Danh sÃ¡ch Bot Anime (Äiá»ƒm sá»‘ giáº£ láº­p)
const botsData = [
    { name: "Conan Edogawa", score: 500, avatar: "ğŸ•µï¸â€â™‚ï¸" },
    { name: "Doraemon", score: 420, avatar: "ğŸ±" },
    { name: "Naruto Uzumaki", score: 350, avatar: "ğŸ¥" },
    { name: "Luffy MÅ© RÆ¡m", score: 280, avatar: "ğŸ‘’" },
    { name: "Suneo (Xeko)", score: 150, avatar: "ğŸ¦Š" },
    { name: "Nobita Nobi", score: 50, avatar: "ğŸ‘“" }
];

// 2. HÃ m má»Ÿ Báº£ng xáº¿p háº¡ng
function openLeaderboard() {
    // Gá»i hÃ m má»Ÿ giao diá»‡n chung (Ä‘á»ƒ áº©n cÃ¡c cÃ¡i khÃ¡c)
    openSection('leaderboardSection');

    // Láº¥y Ä‘iá»ƒm hiá»‡n táº¡i cá»§a ngÆ°á»i dÃ¹ng tá»« bá»™ nhá»›
    // Náº¿u chÆ°a cÃ³ thÃ¬ máº·c Ä‘á»‹nh lÃ  0
    let myScore = parseInt(localStorage.getItem('nihongoScore')) || 0;
    let myName = "Báº¡n (Me)";

    // Cáº­p nháº­t tháº» hiá»ƒn thá»‹ Ä‘iá»ƒm cÃ¡ nhÃ¢n
    document.getElementById('myTotalScore').innerText = myScore;
    document.getElementById('myRankName').innerText = getRankTitle(myScore);

    // Gá»™p danh sÃ¡ch Bot vÃ  NgÆ°á»i chÆ¡i
    let allPlayers = [
        ...botsData,
        { name: myName, score: myScore, avatar: "ğŸ°", isMe: true }
    ];

    // Sáº¯p xáº¿p Ä‘iá»ƒm tá»« cao xuá»‘ng tháº¥p
    allPlayers.sort((a, b) => b.score - a.score);

    // Render ra HTML
    const listContainer = document.getElementById('rankingList');
    listContainer.innerHTML = "";

    allPlayers.forEach((player, index) => {
        const rank = index + 1;
        const isMeClass = player.isMe ? "is-me" : "";
        
        const html = `
            <div class="ranking-item ${isMeClass}">
                <div class="rank-number">#${rank}</div>
                <div class="rank-user-info">
                    <span style="font-size:1.2rem">${player.avatar}</span>
                    <span>${player.name}</span>
                </div>
                <div class="rank-points">${player.score} pts</div>
            </div>
        `;
        listContainer.innerHTML += html;
    });
}

// 3. HÃ m láº¥y danh hiá»‡u dá»±a trÃªn Ä‘iá»ƒm sá»‘
function getRankTitle(score) {
    if (score < 100) return "Thá» Táº­p Sá»± ğŸŒ±";
    if (score < 300) return "Thá» ChÄƒm Chá»‰ ğŸ“š";
    if (score < 500) return "Thá» TaÌ€i GioÌ‰i ğŸ–";
    if (score < 700) return "Thá» ThÃ´ng ThÃ¡i ğŸ“";
    if (score < 1000) return "Thá» ThiÃªn TaÌ€i ğŸ§©";
    return "Thá» Tháº§n ThÃ¡nh ğŸŒŸ";
}

// 4. HÃ m Cá»˜NG ÄIá»‚M (DÃ¹ng Ä‘á»ƒ gá»i khi lÃ m bÃ i táº­p xong)
function addScore(points) {
    let current = parseInt(localStorage.getItem('nihongoScore')) || 0;
    let newScore = current + points;
    localStorage.setItem('nihongoScore', newScore);
    
    // Hiá»‡u á»©ng thÃ´ng bÃ¡o nhá» (Console hoáº·c Alert tÃ¹y báº¡n)
    console.log(`ÄÃ£ cá»™ng ${points} Ä‘iá»ƒm! Tá»•ng: ${newScore}`);
}
/* --- HÃ€M RESET ÄIá»‚M --- */
function resetMyScore() {
    // 1. Há»i xÃ¡c nháº­n Ä‘á»ƒ trÃ¡nh báº¥m nháº§m
    const confirmAction = confirm("Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a toÃ n bá»™ Ä‘iá»ƒm vá» 0 khÃ´ng?");
    
    if (confirmAction) {
        // 2. Äáº·t Ä‘iá»ƒm vá» 0 trong bá»™ nhá»›
        localStorage.setItem('nihongoScore', 0);
        
        // 3. ThÃ´ng bÃ¡o
        alert("ÄÃ£ xÃ³a Ä‘iá»ƒm thÃ nh cÃ´ng! CÃ y láº¡i tá»« Ä‘áº§u nhÃ©! ğŸ°");
        
        // 4. Táº£i láº¡i báº£ng xáº¿p háº¡ng Ä‘á»ƒ cáº­p nháº­t giao diá»‡n ngay láº­p tá»©c
        openLeaderboard();
    }
}